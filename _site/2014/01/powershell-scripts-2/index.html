<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>PowerShell Scripts - Microsoft Playground</title>
<meta name="description" content="During my current project we are using a lot of PowerShell scripts to administrate the environment and make development easier for us. In this post that I will try to update frequently, I will share some of our useful PowerShell scripts. Disabling or Enabling Access Request Within our project we had an application with about 400 sites. All of these sites still had the Access Request enabled. We needed to disable these access requests. For this we created a PowerShell function you can use to enable and disable access requests. ### # Function for enabling and disabling site access requests ### function Set-AccessRequest{     [CmdletBinding()] 	param ( 		[string] $siteUrl = $(Read-Host -prompt &quot;Site Url&quot;),         [bool] $enable  =[System.Convert]::ToBoolean($(Read-Host -prompt &quot;Enable Access Requests&quot;)),         [string] $email = $(Read-Host -prompt &quot;Email&quot;) 	)         $web = Get-SPWeb $SiteUrl;">


  <meta name="author" content="Maik van der Gaag">
  
  <meta property="article:author" content="Maik van der Gaag">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Microsoft Playground">
<meta property="og:title" content="PowerShell Scripts">
<meta property="og:url" content="http://localhost:4000/2014/01/powershell-scripts-2/">


  <meta property="og:description" content="During my current project we are using a lot of PowerShell scripts to administrate the environment and make development easier for us. In this post that I will try to update frequently, I will share some of our useful PowerShell scripts. Disabling or Enabling Access Request Within our project we had an application with about 400 sites. All of these sites still had the Access Request enabled. We needed to disable these access requests. For this we created a PowerShell function you can use to enable and disable access requests. ### # Function for enabling and disabling site access requests ### function Set-AccessRequest{     [CmdletBinding()] 	param ( 		[string] $siteUrl = $(Read-Host -prompt &quot;Site Url&quot;),         [bool] $enable  =[System.Convert]::ToBoolean($(Read-Host -prompt &quot;Enable Access Requests&quot;)),         [string] $email = $(Read-Host -prompt &quot;Email&quot;) 	)         $web = Get-SPWeb $SiteUrl;">



  <meta property="og:image" content="http://localhost:4000/assets/profile/profile.png">



  <meta name="twitter:site" content="@maikvandergaag">
  <meta name="twitter:title" content="PowerShell Scripts">
  <meta name="twitter:description" content="During my current project we are using a lot of PowerShell scripts to administrate the environment and make development easier for us. In this post that I will try to update frequently, I will share some of our useful PowerShell scripts. Disabling or Enabling Access Request Within our project we had an application with about 400 sites. All of these sites still had the Access Request enabled. We needed to disable these access requests. For this we created a PowerShell function you can use to enable and disable access requests. ### # Function for enabling and disabling site access requests ### function Set-AccessRequest{     [CmdletBinding()] 	param ( 		[string] $siteUrl = $(Read-Host -prompt &quot;Site Url&quot;),         [bool] $enable  =[System.Convert]::ToBoolean($(Read-Host -prompt &quot;Enable Access Requests&quot;)),         [string] $email = $(Read-Host -prompt &quot;Email&quot;) 	)         $web = Get-SPWeb $SiteUrl;">
  <meta name="twitter:url" content="http://localhost:4000/2014/01/powershell-scripts-2/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://localhost:4000/assets/profile/profile.png">
    
  

  



  <meta property="article:published_time" content="2014-01-02T14:50:15+01:00">






<link rel="canonical" href="http://localhost:4000/2014/01/powershell-scripts-2/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Maik van der Gaag",
      "url": "http://localhost:4000/",
      "sameAs": ["https://twitter.com/maikvandergaag","https://github.com/maikvandergaag"]
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Microsoft Playground Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<link rel="stylesheet" href="/assets/css/custom.css">

<!-- You can set your favicon here -->
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Microsoft Playground
          <span class="site-subtitle">debug.write('Architecture, Azure, Azure DevOps, Git, GitHub, DevOps');</span>
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/extensions">Extensions</a>
            </li>
<li class="masthead__menu-item">
              <a href="/speaking">Speaking</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/profile/profile.png" alt="Maik van der Gaag" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Maik van der Gaag</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I am <strong>Microsoft Azure MVP</strong>, <strong>Speaker</strong> and <strong>Father</strong>.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Schiedam, The Netherlands</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/maikvandergaag/" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">Linkedin</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="PowerShell Scripts">
    <meta itemprop="description" content='During my current project we are using a lot of PowerShell scripts to administrate the environment and make development easier for us.In this post that I will try to update frequently, I will share some of our useful PowerShell scripts.Disabling or Enabling Access RequestWithin our project we had an application with about 400 sites. All of these sites still had the Access Request enabled. We needed to disable these access requests. For this we created a PowerShell function you can use to enable and disable access requests.#### Function for enabling and disabling site access requests###function Set-AccessRequest{    [CmdletBinding()]	param (		[string] $siteUrl = $(Read-Host -prompt "Site Url"),        [bool] $enable  =[System.Convert]::ToBoolean($(Read-Host -prompt "Enable Access Requests")),        [string] $email = $(Read-Host -prompt "Email")	)       $web = Get-SPWeb $SiteUrl;'>
    <meta itemprop="datePublished" content="2014-01-02T14:50:15+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">PowerShell Scripts
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>During my current project we are using a lot of PowerShell scripts to administrate the environment and make development easier for us.</p>
<p>In this post that I will try to update frequently, I will share some of our useful PowerShell scripts.</p>
<h2>Disabling or Enabling Access Request</h2>
<p>Within our project we had an application with about 400 sites. All of these sites still had the Access Request enabled. We needed to disable these access requests. For this we created a PowerShell function you can use to enable and disable access requests.</p>
<pre class="highlight">###
# Function for enabling and disabling site access requests
###
function Set-AccessRequest{
    [CmdletBinding()]
	param (
		[string] $siteUrl = $(Read-Host -prompt "Site Url"),
        [bool] $enable  =[System.Convert]::ToBoolean($(Read-Host -prompt "Enable Access Requests")),
        [string] $email = $(Read-Host -prompt "Email")
	)
   
    $web = Get-SPWeb $SiteUrl;

    if($enabled){
        Write-Host "Enabling Site Access Requests for site: " $web.Url " for email: " $email -ForegroundColor Green;

        $web.RequestAccessEmail = $email;
    }else{
        Write-Host "Disabling Site Access Requests for site: " $web.Url -ForegroundColor Green;

        $web.RequestAccessEmail = "";
    }

    $web.Update();
}
</pre>
<p> </p>
<h2>Publish files within a site collection</h2>
<p>In some situations you would like to have the ability to publish all files within a specific site collection. For example right before going live with a SharePoint publishing portal you need to be sure that every file is published or else end users could  get a access denied on certain resources.</p>
<pre class="highlight">###
# Function for Publishing files in SharePoint
###
function Publish-FilesInList(){
    param
    (
        [string] $siteUrl = $(Read-Host -prompt "Site Url"),
        [bool] $checkIn = $(Read-Host -prompt "CheckIn when file is CheckedOut"),
        [bool] $debug = $(Read-Host -prompt "Run Debug mode")
    ) 

    Start-SPAssignment -Global
    $site = Get-SPSite $siteUrl
    Write-Host "- Publishing files for the Site Collection:" $site.Url -ForegroundColor Cyan

    foreach($web in $site.AllWebs){
    
        Write-Host " - Publishing files for the Web:" $web.Url -ForegroundColor Cyan
        
        foreach($list in $web.Lists){
            if(!$list.Hidden -And !$list.IsPrivate -AND !$list.IsApplicationList -AND $list.BaseType -eq 1){
                Write-Host "  - Publishing files for the List:" $list.Title -ForegroundColor Cyan
                ProcessFolderGetFiles $list.RootFolder $debug
            }else{
                Write-Host "List is Private, ApplicationList, Hidden or no document library: " $list.Title -ForegroundColor Magenta
            }
        }
    }

    Stop-SPAssignment -Global
}

function ProcessFolderGetFiles(){
    param(
        $folder,
        $debug
    )
    if($debug){Write-Host "    - Processing Folder:" $folder.Name -ForegroundColor Cyan}

    foreach($file in $list.RootFolder.Files){
        if($debug){Write-Host "     - Publishing file:" $file.Name -ForegroundColor Cyan}
        if ($file.Level -ne "Published"){
            if (($file.Level -eq "Checkout" -or $file.CheckOutStatus -ne "None")-and $checkIn){
                Write-Host "      - File is checkedout" -ForegroundColor Yellow
                if($checkIn){
                    Write-Host "     - CheckingIn File" -ForegroundColor Yellow
                    $file.CheckIn("CheckingIn", [Microsoft.SharePoint.SPCheckinType]::MajorCheckIn);
                    $file.Publish('Published using Motion10 Powershell Module');
                    Write-Host "      - File Published" -ForegroundColor Yellow
                }
            }else{
                $file.Publish('Published using Motion10 Powershell Module');
                Write-Host "      - File Published" -ForegroundColor Yellow
            }

            $file.Update();
        }else{
            if($debug){Write-Host "      - File already published" -ForegroundColor Cyan}
        }
    }
    # Use recursion to loop through all subfolders.
    foreach ($subFolder in $folder.SubFolders){
       ProcessFolderGetFiles($Subfolder)
    }
}
</pre>
<h2>Unregister a Custom Claim Provider for a specific zone in a web application</h2>
<p>There are situations were for you will develop custom claim providers. These claim providers can be installed globally on the farm but can also be installed for a specific zone in a web application. The following script will allow you to unregister a custom claim provider for a zone.</p>
<pre class="highlight">function Unregister-CustomClaimProvider{
	param(
		  [string] $DisplayName = $(Read-Host -prompt "Claim Provider Display Name"),
		  [string] $Url = $(Read-Host -prompt "Web Application Identity"),
		  [string] $InternalName = $(Read-Host -prompt "Claim Provider Internal Name"),
		  [string] $Zone = $(Read-Host -prompt "Zone")
	)

	
	$WebApplication = Get-SPWebApplication $Url 
	if ($WebApplication.IisSettings.ContainsKey($Zone)){
		$settings = $WebApplication.GetIisSettingsWithFallback($zone)
		$providers = $settings.ClaimsProviders;
		if($providers.Contains($InternalName)) {
			Write-Host "Claim Provider is registerd in this zone trying to remove..." -ForegroundColor Green
			$providers.Remove($InternalName);
			Set-SPWebApplication -Identity $WebApplication -Zone $Zone -AdditionalClaimProvider $providers
		}else{
			Write-Host "$DisplayName is not registered on $($WebApplication.Url) in zone $Zone" -ForegroundColor Yellow
		}
	}
}
</pre>
<h2>Disable Browser Based Editing for Sites under a Specific Url</h2>
<p>In certain situations you would like to disable all browser based editing for specific sites within SharePoint. With the below PowerShell script you can disable browser based editing.</p>
<pre class="highlight">Get-SPSite -WebApplication [Web Application] -Limit ALL | where {$_.Url.StartsWith("[Url start With]") } | Foreach-Object { 
    Write-Host "Activating Feature Client Based Editing for site" $_.Url
    Enable-SPFeature –identity 8a4b8de2-6fd8-41e9-923c-c7c3c00f8295 -URL $_.Url
}
</pre>
<h2>Warm Up SharePoint 2013 Site Collections</h2>
<p>When you maintain SharePoint environments you would like to warm up the environments for example once a day. The first load on SharePoint still takes a lot of time. For this situation I have developed a warm up script that also take in account your extended Host Named Site Collections.</p>
<pre class="highlight">function WarmUp-Url([string]$url){
    Write-Host "Warming up " $url -ForegroundColor DarkYellow;
    Invoke-WebRequest $url -UseDefaultCredentials -UseBasicParsing; 
}

foreach ($WebApp in (Get-SPWebApplication -IncludeCentralAdministration)){
    $sites = $WebApp | Get-SPSite -Limit All | Get-SPWeb -Limit All
        foreach($site in $sites){
            $html= WarmUp-Url -url $site.Url 
        
            if($site.IsRootWeb){
                $extendedurls = Get-SPSiteURL $site.Url  -ErrorAction SilentlyContinue;

                foreach($url in $extendedurls){
                    if($url.Url -ne $site.Url){                        
                        $html = WarmUp-Url -url $url.Url;
                    }
                }
            }
        $site.Dispose();
    }   
}
</pre>
<h2>Publish Content Types for Specific group</h2>
<p>When you start working with the Content Type Hub in SharePoint you will get in situations were you would like to publish multiple content types at once. In these situations you could use the below function to publish all the content types in a specific group.</p>
<pre class="highlight">Add-PSSnapin Microsoft.SharePoint.PowerShell -ErrorAction SilentlyContinue
function Publish-ContentTypesForGroup {
    param
    (
        [parameter(mandatory=$true)][string]$hubUrl,
        [parameter(mandatory=$true)][string]$group
    ) 

    $site = Get-SPSite $hubUrl

    if(!($site -eq $null))
    {
        $contentTypePublisher = New-Object Microsoft.SharePoint.Taxonomy.ContentTypeSync.ContentTypePublisher ($site)
        $site.RootWeb.ContentTypes | ? {$_.Group -match $group} | % {

            if($_.ReadOnly){
                Write-Host "Content Type" $_Name " is Read Only" -ForegroundColor Yellow;
                $_.ReadOnly = $false;
                $_.Update();
            }
            $contentTypePublisher.Publish($_)
            write-host "Content type" $_.Name "has been republished" -foregroundcolor Green
        }
    }
}</pre>
<h2>Starting the Content Type Subscriber Job</h2>
<p>When you work a lot with the Content Type Hub in SharePoint you would also like to start the Content Type Subscriber job by using PowerShell. The below script does the job the web application you specify.</p>
<pre class="highlight">Add-PSSnapin Microsoft.SharePoint.PowerShell -ErrorAction SilentlyContinue
function Run-SPContentTypeHubJob([string]$url) 
{ 
    $job = Get-SPTimerJob -WebApplication $url | ?{ $_.Name -like "MetadataSubscriberTimerJob"} 

    if ($job -ne $null)  
    {   
        Write-host "The timerjob will be started....." -ForeGroundColor Green
        $job | Start-SPTimerJob 

        Write-host  "Run the admin job..." -ForeGroundColor Green
        Start-SPAdminJob -ErrorAction SilentlyContinue              
    }
    else{
	Write-Host "The Job could not be found" -ForeGroundColor Red
    }
}</pre>
<h2>Delete all items in a List</h2>
<p>During many projects I had situations were I had to remove all items in a list. In this situation you can choose for removing the complete list en recreating it or you could delete every single item. With the below function you can delete every item in the list.</p>
<pre class="highlight">Add-PSSnapin Microsoft.SharePoint.PowerShell -ErrorAction SilentlyContinue
function Clear-SPList {
    param
    (
        [parameter(mandatory=$false)][string]$siteUrl,
        [parameter(mandatory=$false)][string]$listname
    )

    $site = Get-SPSite $siteUrl;
    $web = $site.OpenWeb();
    $list = $web.Lists[$listname];

    write-host "Clearing SharePoint list: " $list.Title -ForeGroundColor Green

    $collListItems = $list.Items;
    $count = $collListItems.Count - 1;
    for($intIndex = $count; $intIndex -gt -1; $intIndex--)
    {
            $collListItems.Delete($intIndex);
    } 
}</pre>
<h2>Finding content types that use a specific field</h2>
<p>It ofton occurs that you would like to delete a site column but can't because it is used by a specific content type. It really takes a long time then to find the right content type. Using the below PowerShell function it is easy and fast to find your content type.</p>
<pre class="highlight">Add-PSSnapin Microsoft.SharePoint.PowerShell -ErrorAction SilentlyContinue
function Find-ContenttypesByField {
    param
    (
        [parameter(mandatory=$false)][string]$siteUrl,
        [parameter(mandatory=$false)][string]$fieldname
    )

  $site = Get-SPSite $siteUrl
  $web = $site.RootWeb;
  $fields = $web.Fields;

  $guid = $fields[$fieldname].id;

  $ct = $web.AvailableContentTypes 
  for ($i=0; $i -lt $ct.count; $i++) 
  {
    for ($j=0; $j -lt $ct[$i].fields.count; $j++) 
    {
      if ($ct[$i].fields[$j].id -eq $guid)
      {
        Write-host $ct[$i].Name " has column";
      }
    }
  }
}</pre>
<h2>Setting up Ping and SharePoint Trust Federation</h2>
<p>For a environment we wanted to setup a SSO environment with for example K2. The most know situation is using ADFS. But at our client we were required to use <a title="Ping" href="https://www.pingidentity.com/" target="_blank" rel="noopener noreferrer">Ping</a>. The configuration an the SharePoint site looks very much the same as ADFS. For a reference I have included the PowerShell script in this post.</p>
<pre class="highlight">Add-PSSnapin Microsoft.SharePoint.PowerShell -ErrorAction SilentlyContinue

$certpath  = "[Ping Certification Path]"
$stsname   = "Auth-iLink"
$stsdesc   = "PingFederate Claims Provider SharePoint"
$stsrealm  = "sharepoint:ping:con"  #realm configured on Ping
$signinurl = "[URL Ping]/idp/prp.wsf"

Write-host "Importing Certification on SharePoint Server (Trust relation)." -ForegroundColor Green
New-SPTrustedRootAuthority -Name "PingFederate IP-STS Sharepoint" -Certificate $certpath

Write-Host "Getting the Certification Object." -ForegroundColor Green
$cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2($certpath)

Write-Host "Setting up Claim Mapping for SharePoint Authentication" -ForegroundColor Green
$mappingRole = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/claims/Group" -IncomingClaimTypeDisplayName "Role" -LocalClaimType "http://schemas.microsoft.com/ws/2008/06/identity/claims/role"
$mappingName = New-SPClaimTypeMapping -IncomingClaimType "http://schemas.xmlsoap.org/claims/CommonName" -IncomingClaimTypeDisplayName "GivenName" -LocalClaimType "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"

Write-Host "Setting Up Token Issuer"
New-SPTrustedIdentityTokenIssuer -Name $stsname -Description $stsdesc -Realm $stsrealm -ImportTrustCertificate $cert -ClaimsMappings $mappingRole,$mappingName -SignInUrl $signinurl -IdentifierClaim $m2.InputClaimType

Write-Host "Trusted Identity Token Issuer is set up."</pre>
<h2>Delete empty sub folders</h2>
<p>For a migration we had a large set of folder with also empty folders in it. During the migration we iterated trough the folders also going trough the empty folders took a lot of time for the migration process. That way we wanted a PowerShell script to delete the empty sub folders. (Remove the –whatif to actually perform the script).</p>
<pre class="highlight">Get-ChildItem -recurse | Where {$_.PSIsContainer -and `
@(Get-ChildItem -Lit $_.Fullname -r | Where {!$_.PSIsContainer}).Length -eq 0} |
Remove-Item -recurse -whatif</pre>
<p> </p>
<h2>Delete site that start with a specific URL.</h2>
<p>When you are using host named site collections within your environment and also build some kind provisioning mechanism (how this can be done with host named site collections can be read <a href="http://msftplayground.com/2013/10/host-named-site-collections-provisioning-by-code-and-in-specific-content-database/" target="_blank" rel="noopener noreferrer">here</a>). You will get in situations that you would like to remove a huge number of site collections that start with a specific URL. By using this script you can:</p>
<pre class="highlight">Get-SPSite -Limit ALL | where {$_.Url.StartsWith("http://spdev.com/sites") } | Foreach-Object { Remove-SPSite $_.Url –Confirm:$False
}</pre>

<h2>Flushing the blob cache</h2>
<p>Because we are using the blob cache within our environment, we also need a easy option to clear the blob cache when we have update our style sheets or maybe JavaScript files.</p>
<p>Using this function you can easily clear the blob cache for a specific web application.</p>
<pre class="highlight">function Flush-SPBlobCache{
        param(
          [string] $Url = $(Read-Host -prompt "Web Application Identity")
        )        
        $webApp = Get-SPWebApplication $Url
        [Microsoft.SharePoint.Publishing.PublishingCache]::FlushBlobCache($webApp)
        Write-Host "Flushed the BLOB cache for:" $webApp
}</pre>
<p> </p>
<h2>Feature upgrading</h2>
<p>For upgrades on our solutions we use the standard upgrading framework of SharePoint. You can read about it <a href="http://msftplayground.com/2012/08/article-published-diwug-magazine-7-sharepoint-2010-solution-life-cycle-management-2/" target="_blank" rel="noopener noreferrer">here</a> this is an article on the upgrading framework for SharePoint 2010 but it is also something for SharePoint 2013.</p>
<p>Using the following function you are able to upgrade a specific feature within a web application.</p>
<pre class="highlight">function Upgrade-SpecificFeatures{
        param(
          [string] $Url = $(Read-Host -prompt "Web Application Identity"),
          [Guid] $ID = $(Read-Host -prompt "Feature ID")

        
      </pre></section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#blob-cache" class="page__taxonomy-item" rel="tag">blob cache</a><span class="sep">, </span>
    
      <a href="/tags/#hub" class="page__taxonomy-item" rel="tag">Hub</a><span class="sep">, </span>
    
      <a href="/tags/#powershell" class="page__taxonomy-item" rel="tag">Powershell</a><span class="sep">, </span>
    
      <a href="/tags/#sharepoint" class="page__taxonomy-item" rel="tag">SharePoint</a><span class="sep">, </span>
    
      <a href="/tags/#sharepoint-2013" class="page__taxonomy-item" rel="tag">SharePoint 2013</a><span class="sep">, </span>
    
      <a href="/tags/#sites" class="page__taxonomy-item" rel="tag">Sites</a><span class="sep">, </span>
    
      <a href="/tags/#upgrading" class="page__taxonomy-item" rel="tag">Upgrading</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#development" class="page__taxonomy-item" rel="tag">Development</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2014-01-02T14:50:15+01:00">January 2, 2014</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=maikvandergaag&amp;text=PowerShell+Scripts%20http%3A%2F%2Flocalhost%3A4000%2F2014%2F01%2Fpowershell-scripts-2%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2014%2F01%2Fpowershell-scripts-2%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Flocalhost%3A4000%2F2014%2F01%2Fpowershell-scripts-2%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2013/12/sharepoint-license-versions-versus-versions/" class="pagination--pager" title="SharePoint License Versions versus Versions
">Previous</a>
    
    
      <a href="/2014/01/filtering-sharepoint-search-results-by-content-source/" class="pagination--pager" title="Filtering SharePoint Search Results by Content Source
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2023/05/creating-a-logic-app-api-connection-that-uses-the-managed-identity-using-bicep/" rel="permalink">Creating a Logic App API Connection that uses the Managed Identity using Bicep
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Logic Apps in Azure provides a platform for building workflows that integrate with various services and APIs. When creating Logic Apps, you must often connec...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2023/03/unlocking-the-power-of-azure-app-registrations-a-guide-to-exposing-your-app-as-an-api-with-user-assignments-required-turned-on/" rel="permalink">“Exposing Azure App Registrations as Secure APIs: A Guide to Authentication with ‘User Assignments Required’ Turned On”
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Azure App Registrations are a powerful tool for managing resource access and integrating applications with Microsoft's cloud services. While these registrati...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022/12/centrally-manage-your-app-configurations/" rel="permalink">Centrally manage your App Configurations
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">The application landscape in Azure has grown significantly in recent years, with a wide range of tools and services available to help businesses build, deplo...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022/10/shift-left-security-with-microsoft-security-devops-msdo/" rel="permalink">Shift Left Security with Microsoft Security DevOps (MSDO)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">With the new capabilities released add Ignite, you are now even more capable of shifting security checks further to the left. In this article, I explain how ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <script src="/assets/scripts/sidebarcontent.js"></script>
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/maikvandergaag/" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">© 2023 Maik van der Gaag. Powered by <a href="https://jekyllrb.com" rel="nofollow noopener noreferrer" target="_blank">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow noopener noreferrer" target="_blank">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
