<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Content Editor WebPart ControlAdapter - Microsoft Playground</title>
<meta name="description" content="One of our clients had a internet facing website. With this website we had a number of problems because it was deployed to our Internet facing farm with Content Deployment. The problem we had was that the Content Editor Web Part (for the rest of this article I will name it CEWP) does not allow relative URLs but saves the complete URL.  So the Internet site had many URLs in the content editor part the referenced to the internal address that you could not access from the internet. Till a few weeks ago we did not have a solution to this problem till i read a blog post (here). They created a Control Adapter that is run when the content editor web part is on a certain page. I have chosen to write out my complete solution because I found that the other post could have been written with more details on how to create it and how to implement it.  The Control Adapter replaces the URLs of the internal site in the CEWP with &quot;/&quot;&nbsp; so that it displays a relative URL so that you can use the link on the internet. So what do you need for this solution:  A feature for adding a link to Central Administration and also places a browser file in the App_Browser Directory for a certain web application.   A application page for saving the URL that has to be saved in the web application properties.   A browser file to set the Control Adapter.   First lets make the browser file to set the Control Adapter to the CEWP:  &lt;browsers&gt;     &lt;browser refID=&quot;Default&quot;&gt;         &lt;controlAdapters&gt;             &lt;adapter controlType=&quot;Microsoft.SharePoint.WebPartPages.ContentEditorWebPart&quot; adapterType=&quot;CEWPFIX.SharePoint.CEWPFIXAdapter, CEWPFIX.SharePoint, Version=1.0.0.0, Culture=neutral, PublicKeyToken=1e8dcda25bf26f8e&quot; /&gt;         &lt;/controlAdapters&gt;     &lt;/browser&gt; &lt;/browsers&gt; What you do in the browser file is that you assign a Adapter to the Microsoft.SharePoint.WebPartPages.ContentEditorWebPart and that is the CEWPFIXAdapter in the example above.  The next step is to make the Control Adapter. So we created a class file and inherit from the System.Web.UI.Adapters.  using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using System.Web.UI.Adapters; using System.IO; using System.Text.RegularExpressions; using Microsoft.SharePoint.Administration; using System.Web.Caching; using Microsoft.SharePoint; namespace CEWPFIX.SharePoint {     /// &lt;summary&gt;      /// ControlAdapter for the Content Editor WebPart      /// &lt;/summary&gt;   ControlAdapter     {         /// &lt;summary&gt;          /// Constant string for the creation of the cache object          /// &lt;/summary&gt;          private const string AlternateUrls = &quot;AlternateUrls&quot;;         /// &lt;summary&gt;          /// Key for the webapplication property          /// &lt;/summary&gt;          private const string FilterUrl = &quot;FilterUrls&quot;;         /// &lt;summary&gt;          /// Override the render function off the CEWP          /// &lt;/summary&gt;          /// &lt;param name=&quot;writer&quot;&gt;HtmlTextWriter write&lt;/param&gt;          protected override void Render(HtmlTextWriter writer)         {             //Create a new stringbuilder              StringBuilder sb = new StringBuilder();             //create a HtmlTextWriter              HtmlTextWriter htw = new HtmlTextWriter(new StringWriter(sb));             //Preform the base Render Method              base.Render(htw);             //Get the output string              string output = sb.ToString();             //Create a list with the alternate access urls              List&lt;Uri&gt; alternateUrls = GetAlternateUrls();             //Read out the list with alternate access urls              foreach (Uri alternateUrl in alternateUrls)             {                 //Replace the url&#39;s with /                  output = output.Replace(alternateUrl.ToString(), &quot;/&quot;);             }             //write the output to the page              writer.Write(output);         }         /// &lt;summary&gt;          /// Method for retrieving the Alternate Access Urls of retrieving them from the Cache          /// &lt;/summary&gt;          /// &lt;returns&gt;&lt;/returns&gt;          private List&lt;Uri&gt; GetAlternateUrls()         {             //Try to retrieve the list from the cache              List&lt;Uri&gt; alternateUrls = (List&lt;Uri&gt;)HttpContext.Current.Cache[AlternateUrls];             //Make sure anonymous users can access the web application properties              SPSecurity.RunWithElevatedPrivileges(delegate()             {                 //If the list is null recreate the list en put it in the chache                  if (alternateUrls == null)                 {                     //Create a new list object                      alternateUrls = new List&lt;Uri&gt;();                     //Retrieve the WebApplication object                      SPWebApplication webApp = SPWebApplication.Lookup(HttpContext.Current.Request.Url);                     if (webApp.Properties.ContainsKey(FilterUrl))                     {                         string[] urls = webApp.Properties[FilterUrl].ToString().Split(new char[] { &#39;;&#39; });                         foreach (string str in urls)                         {                             try                             {                                 Uri url = new Uri(str);                                 alternateUrls.Add(url);                             }                             catch (Exception ex)                             {                                 new ExceptionHandler(&quot;Something went wrong while creating a uri in the CEWPFIXAdapter&quot;, ex);                             }                         }                     }                     //Add the list to the cache                      HttpContext.Current.Cache.Add(AlternateUrls, alternateUrls, null, DateTime.Now.AddHours(12), Cache.NoSlidingExpiration, CacheItemPriority.Normal, null);                 }             });             //return the list with the urls              return alternateUrls;         }     } } This code will make sure the URLs will get the right format.">


  <meta name="author" content="Maik van der Gaag">
  
  <meta property="article:author" content="Maik van der Gaag">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Microsoft Playground">
<meta property="og:title" content="Content Editor WebPart ControlAdapter">
<meta property="og:url" content="http://localhost:4000/2009/02/content-editor-webpart-controladapter/">


  <meta property="og:description" content="One of our clients had a internet facing website. With this website we had a number of problems because it was deployed to our Internet facing farm with Content Deployment. The problem we had was that the Content Editor Web Part (for the rest of this article I will name it CEWP) does not allow relative URLs but saves the complete URL.  So the Internet site had many URLs in the content editor part the referenced to the internal address that you could not access from the internet. Till a few weeks ago we did not have a solution to this problem till i read a blog post (here). They created a Control Adapter that is run when the content editor web part is on a certain page. I have chosen to write out my complete solution because I found that the other post could have been written with more details on how to create it and how to implement it.  The Control Adapter replaces the URLs of the internal site in the CEWP with &quot;/&quot;&nbsp; so that it displays a relative URL so that you can use the link on the internet. So what do you need for this solution:  A feature for adding a link to Central Administration and also places a browser file in the App_Browser Directory for a certain web application.   A application page for saving the URL that has to be saved in the web application properties.   A browser file to set the Control Adapter.   First lets make the browser file to set the Control Adapter to the CEWP:  &lt;browsers&gt;     &lt;browser refID=&quot;Default&quot;&gt;         &lt;controlAdapters&gt;             &lt;adapter controlType=&quot;Microsoft.SharePoint.WebPartPages.ContentEditorWebPart&quot; adapterType=&quot;CEWPFIX.SharePoint.CEWPFIXAdapter, CEWPFIX.SharePoint, Version=1.0.0.0, Culture=neutral, PublicKeyToken=1e8dcda25bf26f8e&quot; /&gt;         &lt;/controlAdapters&gt;     &lt;/browser&gt; &lt;/browsers&gt; What you do in the browser file is that you assign a Adapter to the Microsoft.SharePoint.WebPartPages.ContentEditorWebPart and that is the CEWPFIXAdapter in the example above.  The next step is to make the Control Adapter. So we created a class file and inherit from the System.Web.UI.Adapters.  using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using System.Web.UI.Adapters; using System.IO; using System.Text.RegularExpressions; using Microsoft.SharePoint.Administration; using System.Web.Caching; using Microsoft.SharePoint; namespace CEWPFIX.SharePoint {     /// &lt;summary&gt;      /// ControlAdapter for the Content Editor WebPart      /// &lt;/summary&gt;   ControlAdapter     {         /// &lt;summary&gt;          /// Constant string for the creation of the cache object          /// &lt;/summary&gt;          private const string AlternateUrls = &quot;AlternateUrls&quot;;         /// &lt;summary&gt;          /// Key for the webapplication property          /// &lt;/summary&gt;          private const string FilterUrl = &quot;FilterUrls&quot;;         /// &lt;summary&gt;          /// Override the render function off the CEWP          /// &lt;/summary&gt;          /// &lt;param name=&quot;writer&quot;&gt;HtmlTextWriter write&lt;/param&gt;          protected override void Render(HtmlTextWriter writer)         {             //Create a new stringbuilder              StringBuilder sb = new StringBuilder();             //create a HtmlTextWriter              HtmlTextWriter htw = new HtmlTextWriter(new StringWriter(sb));             //Preform the base Render Method              base.Render(htw);             //Get the output string              string output = sb.ToString();             //Create a list with the alternate access urls              List&lt;Uri&gt; alternateUrls = GetAlternateUrls();             //Read out the list with alternate access urls              foreach (Uri alternateUrl in alternateUrls)             {                 //Replace the url&#39;s with /                  output = output.Replace(alternateUrl.ToString(), &quot;/&quot;);             }             //write the output to the page              writer.Write(output);         }         /// &lt;summary&gt;          /// Method for retrieving the Alternate Access Urls of retrieving them from the Cache          /// &lt;/summary&gt;          /// &lt;returns&gt;&lt;/returns&gt;          private List&lt;Uri&gt; GetAlternateUrls()         {             //Try to retrieve the list from the cache              List&lt;Uri&gt; alternateUrls = (List&lt;Uri&gt;)HttpContext.Current.Cache[AlternateUrls];             //Make sure anonymous users can access the web application properties              SPSecurity.RunWithElevatedPrivileges(delegate()             {                 //If the list is null recreate the list en put it in the chache                  if (alternateUrls == null)                 {                     //Create a new list object                      alternateUrls = new List&lt;Uri&gt;();                     //Retrieve the WebApplication object                      SPWebApplication webApp = SPWebApplication.Lookup(HttpContext.Current.Request.Url);                     if (webApp.Properties.ContainsKey(FilterUrl))                     {                         string[] urls = webApp.Properties[FilterUrl].ToString().Split(new char[] { &#39;;&#39; });                         foreach (string str in urls)                         {                             try                             {                                 Uri url = new Uri(str);                                 alternateUrls.Add(url);                             }                             catch (Exception ex)                             {                                 new ExceptionHandler(&quot;Something went wrong while creating a uri in the CEWPFIXAdapter&quot;, ex);                             }                         }                     }                     //Add the list to the cache                      HttpContext.Current.Cache.Add(AlternateUrls, alternateUrls, null, DateTime.Now.AddHours(12), Cache.NoSlidingExpiration, CacheItemPriority.Normal, null);                 }             });             //return the list with the urls              return alternateUrls;         }     } } This code will make sure the URLs will get the right format.">



  <meta property="og:image" content="http://localhost:4000/assets/profile/profile.png">



  <meta name="twitter:site" content="@maikvandergaag">
  <meta name="twitter:title" content="Content Editor WebPart ControlAdapter">
  <meta name="twitter:description" content="One of our clients had a internet facing website. With this website we had a number of problems because it was deployed to our Internet facing farm with Content Deployment. The problem we had was that the Content Editor Web Part (for the rest of this article I will name it CEWP) does not allow relative URLs but saves the complete URL.  So the Internet site had many URLs in the content editor part the referenced to the internal address that you could not access from the internet. Till a few weeks ago we did not have a solution to this problem till i read a blog post (here). They created a Control Adapter that is run when the content editor web part is on a certain page. I have chosen to write out my complete solution because I found that the other post could have been written with more details on how to create it and how to implement it.  The Control Adapter replaces the URLs of the internal site in the CEWP with &quot;/&quot;&nbsp; so that it displays a relative URL so that you can use the link on the internet. So what do you need for this solution:  A feature for adding a link to Central Administration and also places a browser file in the App_Browser Directory for a certain web application.   A application page for saving the URL that has to be saved in the web application properties.   A browser file to set the Control Adapter.   First lets make the browser file to set the Control Adapter to the CEWP:  &lt;browsers&gt;     &lt;browser refID=&quot;Default&quot;&gt;         &lt;controlAdapters&gt;             &lt;adapter controlType=&quot;Microsoft.SharePoint.WebPartPages.ContentEditorWebPart&quot; adapterType=&quot;CEWPFIX.SharePoint.CEWPFIXAdapter, CEWPFIX.SharePoint, Version=1.0.0.0, Culture=neutral, PublicKeyToken=1e8dcda25bf26f8e&quot; /&gt;         &lt;/controlAdapters&gt;     &lt;/browser&gt; &lt;/browsers&gt; What you do in the browser file is that you assign a Adapter to the Microsoft.SharePoint.WebPartPages.ContentEditorWebPart and that is the CEWPFIXAdapter in the example above.  The next step is to make the Control Adapter. So we created a class file and inherit from the System.Web.UI.Adapters.  using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using System.Web.UI.Adapters; using System.IO; using System.Text.RegularExpressions; using Microsoft.SharePoint.Administration; using System.Web.Caching; using Microsoft.SharePoint; namespace CEWPFIX.SharePoint {     /// &lt;summary&gt;      /// ControlAdapter for the Content Editor WebPart      /// &lt;/summary&gt;   ControlAdapter     {         /// &lt;summary&gt;          /// Constant string for the creation of the cache object          /// &lt;/summary&gt;          private const string AlternateUrls = &quot;AlternateUrls&quot;;         /// &lt;summary&gt;          /// Key for the webapplication property          /// &lt;/summary&gt;          private const string FilterUrl = &quot;FilterUrls&quot;;         /// &lt;summary&gt;          /// Override the render function off the CEWP          /// &lt;/summary&gt;          /// &lt;param name=&quot;writer&quot;&gt;HtmlTextWriter write&lt;/param&gt;          protected override void Render(HtmlTextWriter writer)         {             //Create a new stringbuilder              StringBuilder sb = new StringBuilder();             //create a HtmlTextWriter              HtmlTextWriter htw = new HtmlTextWriter(new StringWriter(sb));             //Preform the base Render Method              base.Render(htw);             //Get the output string              string output = sb.ToString();             //Create a list with the alternate access urls              List&lt;Uri&gt; alternateUrls = GetAlternateUrls();             //Read out the list with alternate access urls              foreach (Uri alternateUrl in alternateUrls)             {                 //Replace the url&#39;s with /                  output = output.Replace(alternateUrl.ToString(), &quot;/&quot;);             }             //write the output to the page              writer.Write(output);         }         /// &lt;summary&gt;          /// Method for retrieving the Alternate Access Urls of retrieving them from the Cache          /// &lt;/summary&gt;          /// &lt;returns&gt;&lt;/returns&gt;          private List&lt;Uri&gt; GetAlternateUrls()         {             //Try to retrieve the list from the cache              List&lt;Uri&gt; alternateUrls = (List&lt;Uri&gt;)HttpContext.Current.Cache[AlternateUrls];             //Make sure anonymous users can access the web application properties              SPSecurity.RunWithElevatedPrivileges(delegate()             {                 //If the list is null recreate the list en put it in the chache                  if (alternateUrls == null)                 {                     //Create a new list object                      alternateUrls = new List&lt;Uri&gt;();                     //Retrieve the WebApplication object                      SPWebApplication webApp = SPWebApplication.Lookup(HttpContext.Current.Request.Url);                     if (webApp.Properties.ContainsKey(FilterUrl))                     {                         string[] urls = webApp.Properties[FilterUrl].ToString().Split(new char[] { &#39;;&#39; });                         foreach (string str in urls)                         {                             try                             {                                 Uri url = new Uri(str);                                 alternateUrls.Add(url);                             }                             catch (Exception ex)                             {                                 new ExceptionHandler(&quot;Something went wrong while creating a uri in the CEWPFIXAdapter&quot;, ex);                             }                         }                     }                     //Add the list to the cache                      HttpContext.Current.Cache.Add(AlternateUrls, alternateUrls, null, DateTime.Now.AddHours(12), Cache.NoSlidingExpiration, CacheItemPriority.Normal, null);                 }             });             //return the list with the urls              return alternateUrls;         }     } } This code will make sure the URLs will get the right format.">
  <meta name="twitter:url" content="http://localhost:4000/2009/02/content-editor-webpart-controladapter/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://localhost:4000/assets/profile/profile.png">
    
  

  



  <meta property="article:published_time" content="2009-02-04T06:42:00+01:00">






<link rel="canonical" href="http://localhost:4000/2009/02/content-editor-webpart-controladapter/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Maik van der Gaag",
      "url": "http://localhost:4000/",
      "sameAs": ["https://twitter.com/maikvandergaag","https://github.com/maikvandergaag"]
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Microsoft Playground Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<link rel="stylesheet" href="/assets/css/custom.css">

<!-- You can set your favicon here -->
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Microsoft Playground
          <span class="site-subtitle">debug.write('Architecture, Azure, Azure DevOps, Git, GitHub, DevOps');</span>
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/extensions">Extensions</a>
            </li>
<li class="masthead__menu-item">
              <a href="/speaking">Speaking</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/profile/profile.png" alt="Maik van der Gaag" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Maik van der Gaag</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I am <strong>Microsoft Azure MVP</strong>, <strong>Speaker</strong> and <strong>Father</strong>.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Schiedam, The Netherlands</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/maikvandergaag/" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">Linkedin</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Content Editor WebPart ControlAdapter">
    <meta itemprop="description" content="One of our clients had a internet facing website. With this website we had a number of problems because it was deployed to our Internet facing farm with Content Deployment. The problem we had was that the Content Editor Web Part (for the rest of this article I will name it CEWP) does not allow relative URLs but saves the complete URL. So the Internet site had many URLs in the content editor part the referenced to the internal address that you could not access from the internet. Till a few weeks ago we did not have a solution to this problem till i read a blog post (here). They created a Control Adapter that is run when the content editor web part is on a certain page. I have chosen to write out my complete solution because I found that the other post could have been written with more details on how to create it and how to implement it. The Control Adapter replaces the URLs of the internal site in the CEWP with &quot;/&quot;  so that it displays a relative URL so that you can use the link on the internet. So what do you need for this solution:A feature for adding a link to Central Administration and also places a browser file in the App_Browser Directory for a certain web application.  A application page for saving the URL that has to be saved in the web application properties.  A browser file to set the Control Adapter. First lets make the browser file to set the Control Adapter to the CEWP: &lt;browsers&gt;    &lt;browser refID=&quot;Default&quot;&gt;        &lt;controlAdapters&gt;            &lt;adapter controlType=&quot;Microsoft.SharePoint.WebPartPages.ContentEditorWebPart&quot; adapterType=&quot;CEWPFIX.SharePoint.CEWPFIXAdapter, CEWPFIX.SharePoint, Version=1.0.0.0, Culture=neutral, PublicKeyToken=1e8dcda25bf26f8e&quot; /&gt;        &lt;/controlAdapters&gt;    &lt;/browser&gt;&lt;/browsers&gt;What you do in the browser file is that you assign a Adapter to the Microsoft.SharePoint.WebPartPages.ContentEditorWebPart and that is the CEWPFIXAdapter in the example above. The next step is to make the Control Adapter. So we created a class file and inherit from the System.Web.UI.Adapters. using System.Web;using System.Web.UI;using System.Web.UI.WebControls;using System.Web.UI.Adapters;using System.IO;using System.Text.RegularExpressions;using Microsoft.SharePoint.Administration;using System.Web.Caching;using Microsoft.SharePoint;namespace CEWPFIX.SharePoint{    /// &lt;summary&gt;     /// ControlAdapter for the Content Editor WebPart     /// &lt;/summary&gt;  ControlAdapter    {        /// &lt;summary&gt;         /// Constant string for the creation of the cache object         /// &lt;/summary&gt;         private const string AlternateUrls = &quot;AlternateUrls&quot;;        /// &lt;summary&gt;         /// Key for the webapplication property         /// &lt;/summary&gt;         private const string FilterUrl = &quot;FilterUrls&quot;;        /// &lt;summary&gt;         /// Override the render function off the CEWP         /// &lt;/summary&gt;         /// &lt;param name=&quot;writer&quot;&gt;HtmlTextWriter write&lt;/param&gt;         protected override void Render(HtmlTextWriter writer)        {            //Create a new stringbuilder             StringBuilder sb = new StringBuilder();            //create a HtmlTextWriter             HtmlTextWriter htw = new HtmlTextWriter(new StringWriter(sb));            //Preform the base Render Method             base.Render(htw);            //Get the output string             string output = sb.ToString();            //Create a list with the alternate access urls             List&lt;Uri&gt; alternateUrls = GetAlternateUrls();            //Read out the list with alternate access urls             foreach (Uri alternateUrl in alternateUrls)            {                //Replace the url's with /                 output = output.Replace(alternateUrl.ToString(), &quot;/&quot;);            }            //write the output to the page             writer.Write(output);        }        /// &lt;summary&gt;         /// Method for retrieving the Alternate Access Urls of retrieving them from the Cache         /// &lt;/summary&gt;         /// &lt;returns&gt;&lt;/returns&gt;         private List&lt;Uri&gt; GetAlternateUrls()        {            //Try to retrieve the list from the cache             List&lt;Uri&gt; alternateUrls = (List&lt;Uri&gt;)HttpContext.Current.Cache[AlternateUrls];            //Make sure anonymous users can access the web application properties             SPSecurity.RunWithElevatedPrivileges(delegate()            {                //If the list is null recreate the list en put it in the chache                 if (alternateUrls == null)                {                    //Create a new list object                     alternateUrls = new List&lt;Uri&gt;();                    //Retrieve the WebApplication object                     SPWebApplication webApp = SPWebApplication.Lookup(HttpContext.Current.Request.Url);                    if (webApp.Properties.ContainsKey(FilterUrl))                    {                        string[] urls = webApp.Properties[FilterUrl].ToString().Split(new char[] { ';' });                        foreach (string str in urls)                        {                            try                            {                                Uri url = new Uri(str);                                alternateUrls.Add(url);                            }                            catch (Exception ex)                            {                                new ExceptionHandler(&quot;Something went wrong while creating a uri in the CEWPFIXAdapter&quot;, ex);                            }                        }                    }                    //Add the list to the cache                     HttpContext.Current.Cache.Add(AlternateUrls, alternateUrls, null, DateTime.Now.AddHours(12), Cache.NoSlidingExpiration, CacheItemPriority.Normal, null);                }            });            //return the list with the urls             return alternateUrls;        }    }}This code will make sure the URLs will get the right format.">
    <meta itemprop="datePublished" content="2009-02-04T06:42:00+01:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Content Editor WebPart ControlAdapter
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <div class="ExternalClass8104489C4BF4408C8CE5113756534CE0">
<p>One of our clients had a internet facing website. With this website we had a number of problems because it was deployed to our Internet facing farm with Content Deployment. The problem we had was that the Content Editor Web Part (for the rest of this article I will name it CEWP) does not allow relative URLs but saves the complete URL. </p>
<p>So the Internet site had many URLs in the content editor part the referenced to the internal address that you could not access from the internet. Till a few weeks ago we did not have a solution to this problem till i read a blog post (<a href="http://blogs.msdn.com/maximeb/archive/2008/12/23/fixing-absolute-urls-for-all-alternate-access-mappings-aam-of-content-editor-web-part-with-a-control-adapter.aspx" target="_blank" rel="noopener noreferrer">here</a>). They created a Control Adapter that is run when the content editor web part is on a certain page. I have chosen to write out my complete solution because I found that the other post could have been written with more details on how to create it and how to implement it. </p>
<p>The Control Adapter replaces the URLs of the internal site in the CEWP with "/"  so that it displays a relative URL so that you can use the link on the internet. So what do you need for this solution:</p>
<ul>
<li>A feature for adding a link to Central Administration and also places a browser file in the App_Browser Directory for a certain web application.  </li>
<li>A application page for saving the URL that has to be saved in the web application properties.  </li>
<li>A browser file to set the Control Adapter. </li>
</ul>
<p>First lets make the browser file to set the Control Adapter to the CEWP: </p>
<pre class="highlight">&lt;browsers&gt;
    &lt;browser refID="Default"&gt;
        &lt;controlAdapters&gt;
            &lt;adapter controlType="Microsoft.SharePoint.WebPartPages.ContentEditorWebPart" adapterType="CEWPFIX.SharePoint.CEWPFIXAdapter, CEWPFIX.SharePoint, Version=1.0.0.0, Culture=neutral, PublicKeyToken=1e8dcda25bf26f8e" /&gt;
        &lt;/controlAdapters&gt;
    &lt;/browser&gt;
&lt;/browsers&gt;</pre>
<p>What you do in the browser file is that you assign a Adapter to the Microsoft.SharePoint.WebPartPages.ContentEditorWebPart and that is the CEWPFIXAdapter in the example above. </p>
<p>The next step is to make the Control Adapter. So we created a class file and inherit from the System.Web.UI.Adapters. </p>
<pre class="highlight">using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.Adapters;
using System.IO;
using System.Text.RegularExpressions;
using Microsoft.SharePoint.Administration;
using System.Web.Caching;
using Microsoft.SharePoint;
namespace CEWPFIX.SharePoint
{
    /// &lt;summary&gt; 
    /// ControlAdapter for the Content Editor WebPart 
    /// &lt;/summary&gt; 
 ControlAdapter
    {
        /// &lt;summary&gt; 
        /// Constant string for the creation of the cache object 
        /// &lt;/summary&gt; 
        private const string AlternateUrls = "AlternateUrls";
        /// &lt;summary&gt; 
        /// Key for the webapplication property 
        /// &lt;/summary&gt; 
        private const string FilterUrl = "FilterUrls";
        /// &lt;summary&gt; 
        /// Override the render function off the CEWP 
        /// &lt;/summary&gt; 
        /// &lt;param name="writer"&gt;HtmlTextWriter write&lt;/param&gt; 
        protected override void Render(HtmlTextWriter writer)
        {
            //Create a new stringbuilder 
            StringBuilder sb = new StringBuilder();
            //create a HtmlTextWriter 
            HtmlTextWriter htw = new HtmlTextWriter(new StringWriter(sb));
            //Preform the base Render Method 
            base.Render(htw);
            //Get the output string 
            string output = sb.ToString();
            //Create a list with the alternate access urls 
            List&lt;Uri&gt; alternateUrls = GetAlternateUrls();
            //Read out the list with alternate access urls 
            foreach (Uri alternateUrl in alternateUrls)
            {
                //Replace the url's with / 
                output = output.Replace(alternateUrl.ToString(), "/");
            }
            //write the output to the page 
            writer.Write(output);
        }
        /// &lt;summary&gt; 
        /// Method for retrieving the Alternate Access Urls of retrieving them from the Cache 
        /// &lt;/summary&gt; 
        /// &lt;returns&gt;&lt;/returns&gt; 
        private List&lt;Uri&gt; GetAlternateUrls()
        {
            //Try to retrieve the list from the cache 
            List&lt;Uri&gt; alternateUrls = (List&lt;Uri&gt;)HttpContext.Current.Cache[AlternateUrls];
            //Make sure anonymous users can access the web application properties 
            SPSecurity.RunWithElevatedPrivileges(delegate()
            {
                //If the list is null recreate the list en put it in the chache 
                if (alternateUrls == null)
                {
                    //Create a new list object 
                    alternateUrls = new List&lt;Uri&gt;();
                    //Retrieve the WebApplication object 
                    SPWebApplication webApp = SPWebApplication.Lookup(HttpContext.Current.Request.Url);
                    if (webApp.Properties.ContainsKey(FilterUrl))
                    {
                        string[] urls = webApp.Properties[FilterUrl].ToString().Split(new char[] { ';' });
                        foreach (string str in urls)
                        {
                            try
                            {
                                Uri url = new Uri(str);
                                alternateUrls.Add(url);
                            }
                            catch (Exception ex)
                            {
                                new ExceptionHandler("Something went wrong while creating a uri in the CEWPFIXAdapter", ex);
                            }
                        }
                    }
                    //Add the list to the cache 
                    HttpContext.Current.Cache.Add(AlternateUrls, alternateUrls, null, DateTime.Now.AddHours(12), Cache.NoSlidingExpiration, CacheItemPriority.Normal, null);
                }
            });
            //return the list with the urls 
            return alternateUrls;
        }
    }
}</pre>
<p>This code will make sure the URLs will get the right format.</p>
</div>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#content-editor" class="page__taxonomy-item" rel="tag">Content Editor</a><span class="sep">, </span>
    
      <a href="/tags/#controladapter" class="page__taxonomy-item" rel="tag">ControlAdapter</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#development" class="page__taxonomy-item" rel="tag">Development</a><span class="sep">, </span>
    
      <a href="/categories/#sharepoint" class="page__taxonomy-item" rel="tag">SharePoint</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2009-02-04T06:42:00+01:00">February 4, 2009</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=maikvandergaag&amp;text=Content+Editor+WebPart+ControlAdapter%20http%3A%2F%2Flocalhost%3A4000%2F2009%2F02%2Fcontent-editor-webpart-controladapter%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2009%2F02%2Fcontent-editor-webpart-controladapter%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Flocalhost%3A4000%2F2009%2F02%2Fcontent-editor-webpart-controladapter%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2009/01/disposing-of-sharepoint-objects-spdisposecheck-tool-finally-available/" class="pagination--pager" title="Disposing of SharePoint Objects (SPDisposeCheck tool Finally Available!)
">Previous</a>
    
    
      <a href="/2009/02/scheduling-sharepoint-backup-part-2/" class="pagination--pager" title="Scheduling SharePoint Backup : Part 2
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2023/05/creating-a-logic-app-api-connection-that-uses-the-managed-identity-using-bicep/" rel="permalink">Creating a Logic App API Connection that uses the Managed Identity using Bicep
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Logic Apps in Azure provides a platform for building workflows that integrate with various services and APIs. When creating Logic Apps, you must often connec...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2023/03/unlocking-the-power-of-azure-app-registrations-a-guide-to-exposing-your-app-as-an-api-with-user-assignments-required-turned-on/" rel="permalink">“Exposing Azure App Registrations as Secure APIs: A Guide to Authentication with ‘User Assignments Required’ Turned On”
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Azure App Registrations are a powerful tool for managing resource access and integrating applications with Microsoft's cloud services. While these registrati...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022/12/centrally-manage-your-app-configurations/" rel="permalink">Centrally manage your App Configurations
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">The application landscape in Azure has grown significantly in recent years, with a wide range of tools and services available to help businesses build, deplo...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022/10/shift-left-security-with-microsoft-security-devops-msdo/" rel="permalink">Shift Left Security with Microsoft Security DevOps (MSDO)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">With the new capabilities released add Ignite, you are now even more capable of shifting security checks further to the left. In this article, I explain how ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <script src="/assets/scripts/sidebarcontent.js"></script>
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/maikvandergaag/" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">© 2023 Maik van der Gaag. Powered by <a href="https://jekyllrb.com" rel="nofollow noopener noreferrer" target="_blank">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow noopener noreferrer" target="_blank">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
