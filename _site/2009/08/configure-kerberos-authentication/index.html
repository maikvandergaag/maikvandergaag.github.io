<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Configure Kerberos authentication - Microsoft Playground</title>
<meta name="description" content="A few weeks ago I tried to set up a SharePoint farm that uses Kerberos authentication. I always thought it was just a setting in SharePoint but infect it is much more than that.  What is Kerberos  Kerberos is a computer network authentication protocol, which allows nodes to communicate over a non secure network to prove their identity to one another.  Kerberos makes use of a trusted third party for the authentication, termed a Key Distribution Center (KDC) which consists of two parts: an Authentication Server (AS) and a Ticket Granting Server (TGS). Kerberos works on the basis of tickets which serve to prove the identity.  For communication between two entities, the KDC generates a session key which they can use to secure their interaction. A KDC runs on every domain controller as a function of the Active Directory Domain Services (AD KS).  Why use Kerberos  There are many reasons why u should use Kerberos authentication rather than the default NTLM. The main reason is because it is more secure than NTML. Besides this reason you should also use it to get around the “double hop” (http://support.microsoft.com/kb/329986) authentication issue. The most common scenarios for the double hop issue with SharePoint are around Excel services and Data Connection.  Setting up Kerberos authentication  To make use of Kerberos nothing needs to be changed if the domain controller is set-up correctly. Kerberos clients are configured to request ticket-granting tickets (TGT’s) of the Kerberos Key Distribution Center automatically. If the ticket is received successfully the Kerberos client saves the ticket on the locale machine.  One of the first things you should consider when you want to use Kerberos authentication is which accounts you will be using for your services and web applications. Those accounts will have to get a Service Principal Name. The servers you will be using will have to allow delegation.  To trust a computer for delegation   Click Start, point to Program Files, point to Administrative Tools, and then click Active Directory Users and Computers.   Navigate to the computer account that needs to be set, for example, Active Directory Users and Computers/&lt;domain name&gt;/Computers/&lt;computer name&gt;.   Double-click the computer name in the list on the right pane. On the Account tab, select the Account is trusted for delegation check box and then click OK.  If every server in the farm is trusted for delegation you can start creating SPN’s (Service Principal Names) for the accounts you will be going to use for SQL Server and the SharePoint farm.  Service Principal Names  Service principal names are associated with the security principal (user or groups) in whose security context the service executes. Service Principal Names are created with a specific Syntax.  Service Principal Name syntax:  The basic syntax of service principal name is as follows: [service type]/[instance name]:[port number]/[service name] The elements of the syntax have the following meaning:  service type: Type of service, such as “http” for the http protocol.   instance name: Name of the instance of the service. Depending upon the service type, it is either the name or IP address of the host running the service.   port number: Number of the port used by the service on the host, if it is different from the default for the service type.   service name: Name of the service. The name can be the DNS name of a host, of a replicated service, or of a domain; or it can be the distinguished name of a service connection point object or of an RPC service object.  Note: When you use Kerberos authentication with SharePoint you have to know that Internet Explorer does not send the port number with the service principal name. For example for this address https://intra.motion10.com:443 the SPN will be http/intra.motion10.com.  How to create a SPN in Active Directory  To create a SPN for an account you have to follow the following steps.  Create the SPNs for your SQL Server service account  Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.   In the Run dialog box, type ADSIEDIT.MSC.   In the management console dialog box, expand the domain container folder.   Expand the container folder containing user accounts, for example CN=Users.   Locate the container for the SQL Server Service account, for example CN=mosssqlsvc.   Right-click this account, and then click Properties.   Scroll down the list of properties in the SQL Server Service account dialog box until you find servicePrincipalName.   Select the servicePrincipalName property and click Edit.   In the Value to Add field, in the Multi-Valued String Editor dialog box, type the SPN for example MSSQLSvc/sqlserver:1433 and click Add.   Click OK on the Multi-Valued String Editor dialog box, and then click OK on the properties dialog box for the SQL Server service account.  Important: You cannot give two accounts the same Service Principal Name. This will cause the authentication to fail or fall back on NTLM if it is possible.  After you created the Service Principal Names you have to trust the accounts for delegation:  Trust accounts for Delegation  Windows server 2003 Active Directory   On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.   Under your domain, click the Users folder.   Under your user account, click Properties.   Navigate to the “Delegation” tab.   Choose “Trust this user/computer for delegation to any service (Kerberos)“.   Windows server 2000 Active Directory   On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.   Under your domain, click the Users folder.   Under your user account, click Properties.   On the Account tab, select the Trusted for delegation check box.   Under the account that you are trying to delegate, clear the Account is sensitive cannot be delegated check box.  Note: If you do not have the delegation tab in the user properties you will have to use the steps of the Windows server 2000 Active Directory. This is because Windows 2003 Active Directory can run a in a 2000 mode.  Configure Kerberos for SQL server  Kerberos for SQL server has to be configured before you can install SharePoint Server 2007. This means we have to create a SPN for the SQL service account:   Service type: MSSQLSvc   Instance name: SQLSERVER / SQLSERVER.mydomain.com   Port number: 1433 (default SQL communication port)   The SPN’s will be:   MSSQLSvc\SQLServer:1433   MSSQLSvc\SQLServer.mydomain.com:1433   Testing the Kerberos authentication for SQL Server  If you have configured the SPN’s for the SQL service account you can test if it works by following the following steps.   Run SQL Server Management Studio in another server in the domain.   Connect to you SQL Server.   Check if Kerberos authentication is used by running the event viewer on your SQL host server and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol.   If there isn’t a Success Audit that uses the Kerberos protocol you can check the following:   Is the SPN in active directory correct?   Do I have two accounts in Active Directory that have the same SPN?   Configure Kerberos for your Web Applications  If you want your web applications to make use of Kerberos you have to create Service Principal Names for the accounts that will used for running the web applications.  If have written down a few examples of SPN’s of several addresses of web applications.     Internet address Service Principal Name   http://intra.motion10.com http/intra.motion10.com   https://intra.motion10.com http/intra.motion10.com   http://mossadmin:43433 http/mossadmin   http://mysites.intranet.com http/mysites.intranet.com     Testing the Kerberos authentication for the web application authentications  If you have created SharePoint web applications that use Kerberos authentication, you are ready to test your configuration by following the following steps:   Start internet explorer and navigate to the web application that has Kerberos authentication enables and login.   On the SharePoint server open the event viewer and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol.   Configure the SSP Infrastructure for Kerberos  For the SSP infrastructure to use Kerberos you have to follow the following steps:   Register a new SPN for the SSP Service.   Configure the SSP infrastructure to use Kerberos   Register a new SPN for the SSP Service  For the SSP infrastructure to use Kerberos a few new SPN’s need to be created. This is because the SSP infrastructure runs on every server in the SharePoint farm. It is also bound to the following ports TCP 56737 en TCP 56738 and the SPN also needs to include the name of the Shared Service Provider.  So you have to create a separate SPN for each server in the farm. In the following table you will see a few examples.      Computer Name:  MOSSQUERY  Name Shared Service Provider  SSP   MSSP/MOSSQUERY:56737/SSP  MSSP/MOSSQUERY:56738/SSP     Computer Name:  MOSSQUERY  Name Shared Service Provider  SharedServices4   MSSP/MOSSQUERY:56737/SharedServices4  MSSP/MOSSQUERY:56738/SharedServices4     Computer Name:  MOSSCRAWL  Name Shared Service Provider  SharedServices1   MSSP/ MOSSCRAWL:56737/ SharedServices1  MSSP/ MOSSCRAWL:56738/SharedServices1     &nbsp; Configure the SSP infrastructure to use Kerberos  After you created the Service Principal Names for the SSP Infrastructure you have to inform the SSP infrastructure to use Kerberos. You can inform the SSP infrastructure by using the stsadm tool.  To configure your SSP infrastructure to use Kerberos authentication, perform the following procedure:  Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.   On one of your servers running Office SharePoint Server 2007, open a command prompt.   Change to the following directory: %COMMONPROGRAMFILES%\microsoft shared\web server extensions\12\bin.   Type the following command: stsadm –o setsharedwebserviceauthn –negotiate, and then press ENTER.  After following all the steps you successfully configured your SharePoint farm to use Kerberos authentication.">


  <meta name="author" content="Maik van der Gaag">
  
  <meta property="article:author" content="Maik van der Gaag">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Microsoft Playground">
<meta property="og:title" content="Configure Kerberos authentication">
<meta property="og:url" content="http://localhost:4000/2009/08/configure-kerberos-authentication/">


  <meta property="og:description" content="A few weeks ago I tried to set up a SharePoint farm that uses Kerberos authentication. I always thought it was just a setting in SharePoint but infect it is much more than that.  What is Kerberos  Kerberos is a computer network authentication protocol, which allows nodes to communicate over a non secure network to prove their identity to one another.  Kerberos makes use of a trusted third party for the authentication, termed a Key Distribution Center (KDC) which consists of two parts: an Authentication Server (AS) and a Ticket Granting Server (TGS). Kerberos works on the basis of tickets which serve to prove the identity.  For communication between two entities, the KDC generates a session key which they can use to secure their interaction. A KDC runs on every domain controller as a function of the Active Directory Domain Services (AD KS).  Why use Kerberos  There are many reasons why u should use Kerberos authentication rather than the default NTLM. The main reason is because it is more secure than NTML. Besides this reason you should also use it to get around the “double hop” (http://support.microsoft.com/kb/329986) authentication issue. The most common scenarios for the double hop issue with SharePoint are around Excel services and Data Connection.  Setting up Kerberos authentication  To make use of Kerberos nothing needs to be changed if the domain controller is set-up correctly. Kerberos clients are configured to request ticket-granting tickets (TGT’s) of the Kerberos Key Distribution Center automatically. If the ticket is received successfully the Kerberos client saves the ticket on the locale machine.  One of the first things you should consider when you want to use Kerberos authentication is which accounts you will be using for your services and web applications. Those accounts will have to get a Service Principal Name. The servers you will be using will have to allow delegation.  To trust a computer for delegation   Click Start, point to Program Files, point to Administrative Tools, and then click Active Directory Users and Computers.   Navigate to the computer account that needs to be set, for example, Active Directory Users and Computers/&lt;domain name&gt;/Computers/&lt;computer name&gt;.   Double-click the computer name in the list on the right pane. On the Account tab, select the Account is trusted for delegation check box and then click OK.  If every server in the farm is trusted for delegation you can start creating SPN’s (Service Principal Names) for the accounts you will be going to use for SQL Server and the SharePoint farm.  Service Principal Names  Service principal names are associated with the security principal (user or groups) in whose security context the service executes. Service Principal Names are created with a specific Syntax.  Service Principal Name syntax:  The basic syntax of service principal name is as follows: [service type]/[instance name]:[port number]/[service name] The elements of the syntax have the following meaning:  service type: Type of service, such as “http” for the http protocol.   instance name: Name of the instance of the service. Depending upon the service type, it is either the name or IP address of the host running the service.   port number: Number of the port used by the service on the host, if it is different from the default for the service type.   service name: Name of the service. The name can be the DNS name of a host, of a replicated service, or of a domain; or it can be the distinguished name of a service connection point object or of an RPC service object.  Note: When you use Kerberos authentication with SharePoint you have to know that Internet Explorer does not send the port number with the service principal name. For example for this address https://intra.motion10.com:443 the SPN will be http/intra.motion10.com.  How to create a SPN in Active Directory  To create a SPN for an account you have to follow the following steps.  Create the SPNs for your SQL Server service account  Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.   In the Run dialog box, type ADSIEDIT.MSC.   In the management console dialog box, expand the domain container folder.   Expand the container folder containing user accounts, for example CN=Users.   Locate the container for the SQL Server Service account, for example CN=mosssqlsvc.   Right-click this account, and then click Properties.   Scroll down the list of properties in the SQL Server Service account dialog box until you find servicePrincipalName.   Select the servicePrincipalName property and click Edit.   In the Value to Add field, in the Multi-Valued String Editor dialog box, type the SPN for example MSSQLSvc/sqlserver:1433 and click Add.   Click OK on the Multi-Valued String Editor dialog box, and then click OK on the properties dialog box for the SQL Server service account.  Important: You cannot give two accounts the same Service Principal Name. This will cause the authentication to fail or fall back on NTLM if it is possible.  After you created the Service Principal Names you have to trust the accounts for delegation:  Trust accounts for Delegation  Windows server 2003 Active Directory   On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.   Under your domain, click the Users folder.   Under your user account, click Properties.   Navigate to the “Delegation” tab.   Choose “Trust this user/computer for delegation to any service (Kerberos)“.   Windows server 2000 Active Directory   On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.   Under your domain, click the Users folder.   Under your user account, click Properties.   On the Account tab, select the Trusted for delegation check box.   Under the account that you are trying to delegate, clear the Account is sensitive cannot be delegated check box.  Note: If you do not have the delegation tab in the user properties you will have to use the steps of the Windows server 2000 Active Directory. This is because Windows 2003 Active Directory can run a in a 2000 mode.  Configure Kerberos for SQL server  Kerberos for SQL server has to be configured before you can install SharePoint Server 2007. This means we have to create a SPN for the SQL service account:   Service type: MSSQLSvc   Instance name: SQLSERVER / SQLSERVER.mydomain.com   Port number: 1433 (default SQL communication port)   The SPN’s will be:   MSSQLSvc\SQLServer:1433   MSSQLSvc\SQLServer.mydomain.com:1433   Testing the Kerberos authentication for SQL Server  If you have configured the SPN’s for the SQL service account you can test if it works by following the following steps.   Run SQL Server Management Studio in another server in the domain.   Connect to you SQL Server.   Check if Kerberos authentication is used by running the event viewer on your SQL host server and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol.   If there isn’t a Success Audit that uses the Kerberos protocol you can check the following:   Is the SPN in active directory correct?   Do I have two accounts in Active Directory that have the same SPN?   Configure Kerberos for your Web Applications  If you want your web applications to make use of Kerberos you have to create Service Principal Names for the accounts that will used for running the web applications.  If have written down a few examples of SPN’s of several addresses of web applications.     Internet address Service Principal Name   http://intra.motion10.com http/intra.motion10.com   https://intra.motion10.com http/intra.motion10.com   http://mossadmin:43433 http/mossadmin   http://mysites.intranet.com http/mysites.intranet.com     Testing the Kerberos authentication for the web application authentications  If you have created SharePoint web applications that use Kerberos authentication, you are ready to test your configuration by following the following steps:   Start internet explorer and navigate to the web application that has Kerberos authentication enables and login.   On the SharePoint server open the event viewer and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol.   Configure the SSP Infrastructure for Kerberos  For the SSP infrastructure to use Kerberos you have to follow the following steps:   Register a new SPN for the SSP Service.   Configure the SSP infrastructure to use Kerberos   Register a new SPN for the SSP Service  For the SSP infrastructure to use Kerberos a few new SPN’s need to be created. This is because the SSP infrastructure runs on every server in the SharePoint farm. It is also bound to the following ports TCP 56737 en TCP 56738 and the SPN also needs to include the name of the Shared Service Provider.  So you have to create a separate SPN for each server in the farm. In the following table you will see a few examples.      Computer Name:  MOSSQUERY  Name Shared Service Provider  SSP   MSSP/MOSSQUERY:56737/SSP  MSSP/MOSSQUERY:56738/SSP     Computer Name:  MOSSQUERY  Name Shared Service Provider  SharedServices4   MSSP/MOSSQUERY:56737/SharedServices4  MSSP/MOSSQUERY:56738/SharedServices4     Computer Name:  MOSSCRAWL  Name Shared Service Provider  SharedServices1   MSSP/ MOSSCRAWL:56737/ SharedServices1  MSSP/ MOSSCRAWL:56738/SharedServices1     &nbsp; Configure the SSP infrastructure to use Kerberos  After you created the Service Principal Names for the SSP Infrastructure you have to inform the SSP infrastructure to use Kerberos. You can inform the SSP infrastructure by using the stsadm tool.  To configure your SSP infrastructure to use Kerberos authentication, perform the following procedure:  Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.   On one of your servers running Office SharePoint Server 2007, open a command prompt.   Change to the following directory: %COMMONPROGRAMFILES%\microsoft shared\web server extensions\12\bin.   Type the following command: stsadm –o setsharedwebserviceauthn –negotiate, and then press ENTER.  After following all the steps you successfully configured your SharePoint farm to use Kerberos authentication.">



  <meta property="og:image" content="http://localhost:4000/assets/profile/profile.png">



  <meta name="twitter:site" content="@maikvandergaag">
  <meta name="twitter:title" content="Configure Kerberos authentication">
  <meta name="twitter:description" content="A few weeks ago I tried to set up a SharePoint farm that uses Kerberos authentication. I always thought it was just a setting in SharePoint but infect it is much more than that.  What is Kerberos  Kerberos is a computer network authentication protocol, which allows nodes to communicate over a non secure network to prove their identity to one another.  Kerberos makes use of a trusted third party for the authentication, termed a Key Distribution Center (KDC) which consists of two parts: an Authentication Server (AS) and a Ticket Granting Server (TGS). Kerberos works on the basis of tickets which serve to prove the identity.  For communication between two entities, the KDC generates a session key which they can use to secure their interaction. A KDC runs on every domain controller as a function of the Active Directory Domain Services (AD KS).  Why use Kerberos  There are many reasons why u should use Kerberos authentication rather than the default NTLM. The main reason is because it is more secure than NTML. Besides this reason you should also use it to get around the “double hop” (http://support.microsoft.com/kb/329986) authentication issue. The most common scenarios for the double hop issue with SharePoint are around Excel services and Data Connection.  Setting up Kerberos authentication  To make use of Kerberos nothing needs to be changed if the domain controller is set-up correctly. Kerberos clients are configured to request ticket-granting tickets (TGT’s) of the Kerberos Key Distribution Center automatically. If the ticket is received successfully the Kerberos client saves the ticket on the locale machine.  One of the first things you should consider when you want to use Kerberos authentication is which accounts you will be using for your services and web applications. Those accounts will have to get a Service Principal Name. The servers you will be using will have to allow delegation.  To trust a computer for delegation   Click Start, point to Program Files, point to Administrative Tools, and then click Active Directory Users and Computers.   Navigate to the computer account that needs to be set, for example, Active Directory Users and Computers/&lt;domain name&gt;/Computers/&lt;computer name&gt;.   Double-click the computer name in the list on the right pane. On the Account tab, select the Account is trusted for delegation check box and then click OK.  If every server in the farm is trusted for delegation you can start creating SPN’s (Service Principal Names) for the accounts you will be going to use for SQL Server and the SharePoint farm.  Service Principal Names  Service principal names are associated with the security principal (user or groups) in whose security context the service executes. Service Principal Names are created with a specific Syntax.  Service Principal Name syntax:  The basic syntax of service principal name is as follows: [service type]/[instance name]:[port number]/[service name] The elements of the syntax have the following meaning:  service type: Type of service, such as “http” for the http protocol.   instance name: Name of the instance of the service. Depending upon the service type, it is either the name or IP address of the host running the service.   port number: Number of the port used by the service on the host, if it is different from the default for the service type.   service name: Name of the service. The name can be the DNS name of a host, of a replicated service, or of a domain; or it can be the distinguished name of a service connection point object or of an RPC service object.  Note: When you use Kerberos authentication with SharePoint you have to know that Internet Explorer does not send the port number with the service principal name. For example for this address https://intra.motion10.com:443 the SPN will be http/intra.motion10.com.  How to create a SPN in Active Directory  To create a SPN for an account you have to follow the following steps.  Create the SPNs for your SQL Server service account  Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.   In the Run dialog box, type ADSIEDIT.MSC.   In the management console dialog box, expand the domain container folder.   Expand the container folder containing user accounts, for example CN=Users.   Locate the container for the SQL Server Service account, for example CN=mosssqlsvc.   Right-click this account, and then click Properties.   Scroll down the list of properties in the SQL Server Service account dialog box until you find servicePrincipalName.   Select the servicePrincipalName property and click Edit.   In the Value to Add field, in the Multi-Valued String Editor dialog box, type the SPN for example MSSQLSvc/sqlserver:1433 and click Add.   Click OK on the Multi-Valued String Editor dialog box, and then click OK on the properties dialog box for the SQL Server service account.  Important: You cannot give two accounts the same Service Principal Name. This will cause the authentication to fail or fall back on NTLM if it is possible.  After you created the Service Principal Names you have to trust the accounts for delegation:  Trust accounts for Delegation  Windows server 2003 Active Directory   On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.   Under your domain, click the Users folder.   Under your user account, click Properties.   Navigate to the “Delegation” tab.   Choose “Trust this user/computer for delegation to any service (Kerberos)“.   Windows server 2000 Active Directory   On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.   Under your domain, click the Users folder.   Under your user account, click Properties.   On the Account tab, select the Trusted for delegation check box.   Under the account that you are trying to delegate, clear the Account is sensitive cannot be delegated check box.  Note: If you do not have the delegation tab in the user properties you will have to use the steps of the Windows server 2000 Active Directory. This is because Windows 2003 Active Directory can run a in a 2000 mode.  Configure Kerberos for SQL server  Kerberos for SQL server has to be configured before you can install SharePoint Server 2007. This means we have to create a SPN for the SQL service account:   Service type: MSSQLSvc   Instance name: SQLSERVER / SQLSERVER.mydomain.com   Port number: 1433 (default SQL communication port)   The SPN’s will be:   MSSQLSvc\SQLServer:1433   MSSQLSvc\SQLServer.mydomain.com:1433   Testing the Kerberos authentication for SQL Server  If you have configured the SPN’s for the SQL service account you can test if it works by following the following steps.   Run SQL Server Management Studio in another server in the domain.   Connect to you SQL Server.   Check if Kerberos authentication is used by running the event viewer on your SQL host server and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol.   If there isn’t a Success Audit that uses the Kerberos protocol you can check the following:   Is the SPN in active directory correct?   Do I have two accounts in Active Directory that have the same SPN?   Configure Kerberos for your Web Applications  If you want your web applications to make use of Kerberos you have to create Service Principal Names for the accounts that will used for running the web applications.  If have written down a few examples of SPN’s of several addresses of web applications.     Internet address Service Principal Name   http://intra.motion10.com http/intra.motion10.com   https://intra.motion10.com http/intra.motion10.com   http://mossadmin:43433 http/mossadmin   http://mysites.intranet.com http/mysites.intranet.com     Testing the Kerberos authentication for the web application authentications  If you have created SharePoint web applications that use Kerberos authentication, you are ready to test your configuration by following the following steps:   Start internet explorer and navigate to the web application that has Kerberos authentication enables and login.   On the SharePoint server open the event viewer and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol.   Configure the SSP Infrastructure for Kerberos  For the SSP infrastructure to use Kerberos you have to follow the following steps:   Register a new SPN for the SSP Service.   Configure the SSP infrastructure to use Kerberos   Register a new SPN for the SSP Service  For the SSP infrastructure to use Kerberos a few new SPN’s need to be created. This is because the SSP infrastructure runs on every server in the SharePoint farm. It is also bound to the following ports TCP 56737 en TCP 56738 and the SPN also needs to include the name of the Shared Service Provider.  So you have to create a separate SPN for each server in the farm. In the following table you will see a few examples.      Computer Name:  MOSSQUERY  Name Shared Service Provider  SSP   MSSP/MOSSQUERY:56737/SSP  MSSP/MOSSQUERY:56738/SSP     Computer Name:  MOSSQUERY  Name Shared Service Provider  SharedServices4   MSSP/MOSSQUERY:56737/SharedServices4  MSSP/MOSSQUERY:56738/SharedServices4     Computer Name:  MOSSCRAWL  Name Shared Service Provider  SharedServices1   MSSP/ MOSSCRAWL:56737/ SharedServices1  MSSP/ MOSSCRAWL:56738/SharedServices1     &nbsp; Configure the SSP infrastructure to use Kerberos  After you created the Service Principal Names for the SSP Infrastructure you have to inform the SSP infrastructure to use Kerberos. You can inform the SSP infrastructure by using the stsadm tool.  To configure your SSP infrastructure to use Kerberos authentication, perform the following procedure:  Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.   On one of your servers running Office SharePoint Server 2007, open a command prompt.   Change to the following directory: %COMMONPROGRAMFILES%\microsoft shared\web server extensions\12\bin.   Type the following command: stsadm –o setsharedwebserviceauthn –negotiate, and then press ENTER.  After following all the steps you successfully configured your SharePoint farm to use Kerberos authentication.">
  <meta name="twitter:url" content="http://localhost:4000/2009/08/configure-kerberos-authentication/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://localhost:4000/assets/profile/profile.png">
    
  

  



  <meta property="article:published_time" content="2009-08-08T06:33:00+02:00">






<link rel="canonical" href="http://localhost:4000/2009/08/configure-kerberos-authentication/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Maik van der Gaag",
      "url": "http://localhost:4000/",
      "sameAs": ["https://twitter.com/maikvandergaag","https://github.com/maikvandergaag"]
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Microsoft Playground Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<link rel="stylesheet" href="/assets/css/custom.css">

<!-- You can set your favicon here -->
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Microsoft Playground
          <span class="site-subtitle">debug.write('Architecture, Azure, Azure DevOps, Git, GitHub, DevOps');</span>
        </a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/about">About</a>
            </li>
<li class="masthead__menu-item">
              <a href="/extensions">Extensions</a>
            </li>
<li class="masthead__menu-item">
              <a href="/speaking">Speaking</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories">Categories</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/profile/profile.png" alt="Maik van der Gaag" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Maik van der Gaag</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I am <strong>Microsoft Azure MVP</strong>, <strong>Speaker</strong> and <strong>Father</strong>.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Schiedam, The Netherlands</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/maikvandergaag/" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">Linkedin</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Configure Kerberos authentication">
    <meta itemprop="description" content="A few weeks ago I tried to set up a SharePoint farm that uses Kerberos authentication. I always thought it was just a setting in SharePoint but infect it is much more than that. What is Kerberos Kerberos is a computer network authentication protocol, which allows nodes to communicate over a non secure network to prove their identity to one another. Kerberos makes use of a trusted third party for the authentication, termed a Key Distribution Center (KDC) which consists of two parts: an Authentication Server (AS) and a Ticket Granting Server (TGS). Kerberos works on the basis of tickets which serve to prove the identity. For communication between two entities, the KDC generates a session key which they can use to secure their interaction. A KDC runs on every domain controller as a function of the Active Directory Domain Services (AD KS). Why use Kerberos There are many reasons why u should use Kerberos authentication rather than the default NTLM. The main reason is because it is more secure than NTML. Besides this reason you should also use it to get around the “double hop” (http://support.microsoft.com/kb/329986) authentication issue. The most common scenarios for the double hop issue with SharePoint are around Excel services and Data Connection. Setting up Kerberos authentication To make use of Kerberos nothing needs to be changed if the domain controller is set-up correctly. Kerberos clients are configured to request ticket-granting tickets (TGT’s) of the Kerberos Key Distribution Center automatically. If the ticket is received successfully the Kerberos client saves the ticket on the locale machine. One of the first things you should consider when you want to use Kerberos authentication is which accounts you will be using for your services and web applications. Those accounts will have to get a Service Principal Name. The servers you will be using will have to allow delegation. To trust a computer for delegation Click Start, point to Program Files, point to Administrative Tools, and then click Active Directory Users and Computers.  Navigate to the computer account that needs to be set, for example, Active Directory Users and Computers/&lt;domain name&gt;/Computers/&lt;computer name&gt;.  Double-click the computer name in the list on the right pane. On the Account tab, select the Account is trusted for delegation check box and then click OK.If every server in the farm is trusted for delegation you can start creating SPN’s (Service Principal Names) for the accounts you will be going to use for SQL Server and the SharePoint farm. Service Principal Names Service principal names are associated with the security principal (user or groups) in whose security context the service executes. Service Principal Names are created with a specific Syntax. Service Principal Name syntax: The basic syntax of service principal name is as follows:[service type]/[instance name]:[port number]/[service name]The elements of the syntax have the following meaning:service type: Type of service, such as “http” for the http protocol.  instance name: Name of the instance of the service. Depending upon the service type, it is either the name or IP address of the host running the service.  port number: Number of the port used by the service on the host, if it is different from the default for the service type.  service name: Name of the service. The name can be the DNS name of a host, of a replicated service, or of a domain; or it can be the distinguished name of a service connection point object or of an RPC service object.Note: When you use Kerberos authentication with SharePoint you have to know that Internet Explorer does not send the port number with the service principal name. For example for this address https://intra.motion10.com:443 the SPN will be http/intra.motion10.com. How to create a SPN in Active Directory To create a SPN for an account you have to follow the following steps. Create the SPNs for your SQL Server service accountLog on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.  In the Run dialog box, type ADSIEDIT.MSC.  In the management console dialog box, expand the domain container folder.  Expand the container folder containing user accounts, for example CN=Users.  Locate the container for the SQL Server Service account, for example CN=mosssqlsvc.  Right-click this account, and then click Properties.  Scroll down the list of properties in the SQL Server Service account dialog box until you find servicePrincipalName.  Select the servicePrincipalName property and click Edit.  In the Value to Add field, in the Multi-Valued String Editor dialog box, type the SPN for example MSSQLSvc/sqlserver:1433 and click Add.  Click OK on the Multi-Valued String Editor dialog box, and then click OK on the properties dialog box for the SQL Server service account.Important: You cannot give two accounts the same Service Principal Name. This will cause the authentication to fail or fall back on NTLM if it is possible. After you created the Service Principal Names you have to trust the accounts for delegation: Trust accounts for Delegation Windows server 2003 Active Directory On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.  Under your domain, click the Users folder.  Under your user account, click Properties.  Navigate to the “Delegation” tab.  Choose “Trust this user/computer for delegation to any service (Kerberos)“. Windows server 2000 Active Directory On the Domain controller, click Start, point to Programs, point to Administrative Tools, and click Active Directory Users and Computers.  Under your domain, click the Users folder.  Under your user account, click Properties.  On the Account tab, select the Trusted for delegation check box.  Under the account that you are trying to delegate, clear the Account is sensitive cannot be delegated check box.Note: If you do not have the delegation tab in the user properties you will have to use the steps of the Windows server 2000 Active Directory. This is because Windows 2003 Active Directory can run a in a 2000 mode. Configure Kerberos for SQL server Kerberos for SQL server has to be configured before you can install SharePoint Server 2007. This means we have to create a SPN for the SQL service account: Service type: MSSQLSvc  Instance name: SQLSERVER / SQLSERVER.mydomain.com  Port number: 1433 (default SQL communication port) The SPN’s will be: MSSQLSvc\SQLServer:1433  MSSQLSvc\SQLServer.mydomain.com:1433 Testing the Kerberos authentication for SQL Server If you have configured the SPN’s for the SQL service account you can test if it works by following the following steps. Run SQL Server Management Studio in another server in the domain.  Connect to you SQL Server.  Check if Kerberos authentication is used by running the event viewer on your SQL host server and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol. If there isn’t a Success Audit that uses the Kerberos protocol you can check the following: Is the SPN in active directory correct?  Do I have two accounts in Active Directory that have the same SPN? Configure Kerberos for your Web Applications If you want your web applications to make use of Kerberos you have to create Service Principal Names for the accounts that will used for running the web applications. If have written down a few examples of SPN’s of several addresses of web applications. Internet addressService Principal Namehttp://intra.motion10.comhttp/intra.motion10.comhttps://intra.motion10.comhttp/intra.motion10.comhttp://mossadmin:43433http/mossadminhttp://mysites.intranet.comhttp/mysites.intranet.comTesting the Kerberos authentication for the web application authentications If you have created SharePoint web applications that use Kerberos authentication, you are ready to test your configuration by following the following steps: Start internet explorer and navigate to the web application that has Kerberos authentication enables and login.  On the SharePoint server open the event viewer and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol. Configure the SSP Infrastructure for Kerberos For the SSP infrastructure to use Kerberos you have to follow the following steps: Register a new SPN for the SSP Service.  Configure the SSP infrastructure to use Kerberos Register a new SPN for the SSP Service For the SSP infrastructure to use Kerberos a few new SPN’s need to be created. This is because the SSP infrastructure runs on every server in the SharePoint farm. It is also bound to the following ports TCP 56737 en TCP 56738 and the SPN also needs to include the name of the Shared Service Provider. So you have to create a separate SPN for each server in the farm. In the following table you will see a few examples. Computer Name: MOSSQUERY Name Shared Service Provider SSPMSSP/MOSSQUERY:56737/SSP MSSP/MOSSQUERY:56738/SSPComputer Name: MOSSQUERY Name Shared Service Provider SharedServices4MSSP/MOSSQUERY:56737/SharedServices4 MSSP/MOSSQUERY:56738/SharedServices4Computer Name: MOSSCRAWL Name Shared Service Provider SharedServices1MSSP/ MOSSCRAWL:56737/ SharedServices1 MSSP/ MOSSCRAWL:56738/SharedServices1 Configure the SSP infrastructure to use Kerberos After you created the Service Principal Names for the SSP Infrastructure you have to inform the SSP infrastructure to use Kerberos. You can inform the SSP infrastructure by using the stsadm tool. To configure your SSP infrastructure to use Kerberos authentication, perform the following procedure:Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.  On one of your servers running Office SharePoint Server 2007, open a command prompt.  Change to the following directory: %COMMONPROGRAMFILES%\microsoft shared\web server extensions\12\bin.  Type the following command: stsadm –o setsharedwebserviceauthn –negotiate, and then press ENTER.After following all the steps you successfully configured your SharePoint farm to use Kerberos authentication.">
    <meta itemprop="datePublished" content="2009-08-08T06:33:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Configure Kerberos authentication
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <div class="ExternalClassDBFEB076CEA4490A9FAC031809EEC11C">
<p>A few weeks ago I tried to set up a SharePoint farm that uses Kerberos authentication. I always thought it was just a setting in SharePoint but infect it is much more than that. </p>
<p><strong>What is Kerberos <br></strong></p>
<p>Kerberos is a computer network authentication protocol, which allows nodes to communicate over a non secure network to prove their identity to one another. </p>
<p>Kerberos makes use of a trusted third party for the authentication, termed a Key Distribution Center (KDC) which consists of two parts: an Authentication Server (AS) and a Ticket Granting Server (TGS). Kerberos works on the basis of tickets which serve to prove the identity. </p>
<p>For communication between two entities, the KDC generates a session key which they can use to secure their interaction. A KDC runs on every domain controller as a function of the Active Directory Domain Services (AD KS). </p>
<p><strong>Why use Kerberos <br></strong></p>
<p>There are many reasons why u should use Kerberos authentication rather than the default NTLM. The main reason is because it is more secure than NTML. Besides this reason you should also use it to get around the “double hop” (http://support.microsoft.com/kb/329986) authentication issue. The most common scenarios for the double hop issue with SharePoint are around Excel services and Data Connection. </p>
<p><strong>Setting up Kerberos authentication <br></strong></p>
<p>To make use of Kerberos nothing needs to be changed if the domain controller is set-up correctly. Kerberos clients are configured to request ticket-granting tickets (TGT’s) of the Kerberos Key Distribution Center automatically. If the ticket is received successfully the Kerberos client saves the ticket on the locale machine. </p>
<p>One of the first things you should consider when you want to use Kerberos authentication is which accounts you will be using for your services and web applications. Those accounts will have to get a Service Principal Name. The servers you will be using will have to allow delegation. </p>
<p><strong>To trust a computer for delegation <br></strong></p>
<ol>
<li>Click <strong>Start</strong>, point to <strong>Program Files</strong>, point to <strong>Administrative Tools</strong>, and then click <strong>Active Directory Users and Computers</strong>.  </li>
<li>Navigate to the computer account that needs to be set, for example, Active Directory Users and Computers/&lt;<em>domain name</em>&gt;/Computers/<em>&lt;computer name&gt;.</em>  </li>
<li>Double-click the computer name in the list on the right pane. On the <strong>Account</strong> tab, select the <strong>Account is trusted for delegation</strong> check box and then click <strong>OK</strong>.</li>
</ol>
<p>If every server in the farm is trusted for delegation you can start creating SPN’s (Service Principal Names) for the accounts you will be going to use for SQL Server and the SharePoint farm. </p>
<p><strong>Service Principal Names <br></strong></p>
<p>Service principal names are associated with the security principal (user or groups) in whose security context the service executes. Service Principal Names are created with a specific Syntax. </p>
<p><strong>Service Principal Name syntax: <br></strong></p>
<p>The basic syntax of service principal name is as follows:</p>
<p><em>[service type]</em>/[<em>instance name]</em>:[<em>port number]</em>/[<em>service name]</em></p>
<p>The elements of the syntax have the following meaning:</p>
<ul>
<li>
<strong>service type: </strong>Type of service, such as “http” for the http protocol.  </li>
<li>
<strong>instance name:</strong> Name of the instance of the service. Depending upon the service type, it is either the name or IP address of the host running the service.  </li>
<li>
<strong>port number: </strong>Number of the port used by the service on the host, if it is different from the default for the service type.  </li>
<li>
<strong>service name:</strong> Name of the service. The name can be the DNS name of a host, of a replicated service, or of a domain; or it can be the distinguished name of a <strong>service connection point</strong> object or of an <strong>RPC service</strong> object.</li>
</ul>
<p><em><strong>Note:</strong> When you use Kerberos authentication with SharePoint you have to know that Internet Explorer does not send the port number with the service principal name. For example for this address https://intra.motion10.com:443 the SPN will be http/intra.motion10.com. <br></em></p>
<p><strong>How to create a SPN in Active Directory <br></strong></p>
<p>To create a SPN for an account you have to follow the following steps. </p>
<h5>Create the SPNs for your SQL Server service account</h5>
<ol>
<li>Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.  </li>
<li>In the <strong>Run</strong> dialog box, type <strong>ADSIEDIT.MSC</strong>.  </li>
<li>In the management console dialog box, expand the domain container folder.  </li>
<li>Expand the container folder containing user accounts, for example CN=Users.  </li>
<li>Locate the container for the SQL Server Service account, for example CN=mosssqlsvc.  </li>
<li>Right-click this <strong>account</strong>, and then click <strong>Properties</strong>.  </li>
<li>Scroll down the list of properties in the <strong>SQL Server Service account</strong> dialog box until you find <strong>servicePrincipalName</strong>.  </li>
<li>Select the <strong>servicePrincipalName</strong> property and click <strong>Edit</strong>.  </li>
<li>In the <strong>Value to Add field</strong>, in the <strong>Multi-Valued String Editor</strong> dialog box, type the SPN for example <strong>MSSQLSvc/sqlserver:1433</strong> and click <strong>Add</strong>.  </li>
<li>Click <strong>OK</strong> on the <strong>Multi-Valued String Editor</strong> dialog box, and then click <strong>OK</strong> on the properties dialog box for the SQL Server service account.</li>
</ol>
<p><em><strong>Important: </strong>You cannot give two accounts the same Service Principal Name. This will cause the authentication to fail or fall back on NTLM if it is possible. <br></em></p>
<p>After you created the Service Principal Names you have to trust the accounts for delegation: </p>
<p><strong>Trust accounts for Delegation <br></strong></p>
<p><strong>Windows server 2003 Active Directory <br></strong></p>
<ol>
<li>On the Domain controller, click <strong>Start</strong>, point to <strong>Programs</strong>, point to <strong>Administrative Tools</strong>, and click <strong>Active Directory Users and Computers</strong>.  </li>
<li>Under your domain, click the <strong>Users</strong> folder.  </li>
<li>Under your user account, click <strong>Properties</strong>.  </li>
<li>Navigate to the “<strong>Delegation</strong>” tab.  </li>
<li>Choose “<strong>Trust this user/computer for delegation to any service (Kerberos)</strong>“. </li>
</ol>
<p><strong>Windows server 2000 Active Directory <br></strong></p>
<ol>
<li>On the Domain controller, click <strong>Start</strong>, point to <strong>Programs</strong>, point to <strong>Administrative Tools</strong>, and click <strong>Active Directory Users and Computers</strong>.  </li>
<li>Under your domain, click the <strong>Users</strong> folder.  </li>
<li>Under your user account, click <strong>Properties</strong>.  </li>
<li>On the <strong>Account</strong> tab, select the <strong>Trusted for delegation</strong> check box.  </li>
<li>Under the account that you are trying to delegate, clear the <strong>Account is sensitive cannot be delegated</strong> check box.</li>
</ol>
<p><em><strong>Note</strong>: If you do not have the delegation tab in the user properties you will have to use the steps of the Windows server 2000 Active Directory. This is because Windows 2003 Active Directory can run a in a 2000 mode. <br></em></p>
<p><strong>Configure Kerberos for SQL server <br></strong></p>
<p>Kerberos for SQL server has to be configured before you can install SharePoint Server 2007. This means we have to create a SPN for the SQL service account: </p>
<ul>
<li>
<strong>Service type:</strong> MSSQLSvc  </li>
<li>
<strong>Instance name:</strong> SQLSERVER / SQLSERVER.mydomain.com  </li>
<li>
<strong>Port number:</strong> 1433 (default SQL communication port) </li>
</ul>
<p>The SPN’s will be: </p>
<ul>
<li>MSSQLSvc\SQLServer:1433  </li>
<li>MSSQLSvc\SQLServer.mydomain.com:1433 </li>
</ul>
<p><strong>Testing the Kerberos authentication for SQL Server <br></strong></p>
<p>If you have configured the SPN’s for the SQL service account you can test if it works by following the following steps. </p>
<ol>
<li>Run SQL Server Management Studio in <strong>another server in the domain.</strong>  </li>
<li>Connect to you SQL Server.  </li>
<li>Check if Kerberos authentication is used by running the event viewer on your SQL host server and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol. </li>
</ol>
<p>If there isn’t a Success Audit that uses the Kerberos protocol you can check the following: </p>
<ul>
<li>Is the SPN in active directory correct?  </li>
<li>Do I have two accounts in Active Directory that have the same SPN? </li>
</ul>
<p><strong>Configure Kerberos for your Web Applications <br></strong></p>
<p>If you want your web applications to make use of Kerberos you have to create Service Principal Names for the accounts that will used for running the web applications. </p>
<p>If have written down a few examples of SPN’s of several addresses of web applications. </p>
<table cellspacing="0" cellpadding="2" width="500" border="0">
<tbody>
<tr>
<td valign="top" width="250"><strong>Internet address</strong></td>
<td valign="top" width="250"><strong>Service Principal Name</strong></td>
</tr>
<tr>
<td valign="top" width="250"><strong>http://intra.motion10.com</strong></td>
<td valign="top" width="250">http/intra.motion10.com</td>
</tr>
<tr>
<td valign="top" width="250"><strong>https://intra.motion10.com</strong></td>
<td valign="top" width="250">http/intra.motion10.com</td>
</tr>
<tr>
<td valign="top" width="250"><strong>http://mossadmin:43433</strong></td>
<td valign="top" width="250">http/mossadmin</td>
</tr>
<tr>
<td valign="top" width="250"><a href="http://mysites.intranet.com" target="_blank" rel="noopener noreferrer"><strong>http://mysites.intranet.com</strong></a></td>
<td valign="top" width="250">http/mysites.intranet.com</td>
</tr>
</tbody>
</table>
<p></p>
<p><strong>Testing the Kerberos authentication for the web application authentications <br></strong></p>
<p>If you have created SharePoint web applications that use Kerberos authentication, you are ready to test your configuration by following the following steps: </p>
<ol>
<li>Start internet explorer and navigate to the web application that has Kerberos authentication enables and login.  </li>
<li>On the SharePoint server open the event viewer and examine the Security log. In this log you should have a Success Audit that has used the Kerberos protocol. </li>
</ol>
<p><strong>Configure the SSP Infrastructure for Kerberos <br></strong></p>
<p>For the SSP infrastructure to use Kerberos you have to follow the following steps: </p>
<ol>
<li>Register a new SPN for the SSP Service.  </li>
<li>Configure the SSP infrastructure to use Kerberos </li>
</ol>
<p><strong>Register a new SPN for the SSP Service <br></strong></p>
<p>For the SSP infrastructure to use Kerberos a few new SPN’s need to be created. This is because the SSP infrastructure runs on every server in the SharePoint farm. It is also bound to the following ports TCP 56737 en TCP 56738 and the SPN also needs to include the name of the Shared Service Provider. </p>
<p>So you have to create a separate SPN for each server in the farm. In the following table you will see a few examples. </p>
<table cellspacing="0" cellpadding="2" width="500" border="0">
<tbody>
<tr>
<td valign="top" width="250">
<p><strong>Computer Name: <br></strong></p>
<p>MOSSQUERY </p>
<p><strong>Name Shared Service Provider <br></strong></p>
<p>SSP</p>
</td>
<td valign="top" width="250">
<p>MSSP/MOSSQUERY:56737/SSP </p>
<p>MSSP/MOSSQUERY:56738/SSP</p>
</td>
</tr>
<tr>
<td valign="top" width="250">
<p><strong>Computer Name: <br></strong></p>
<p>MOSSQUERY </p>
<p><strong>Name Shared Service Provider <br></strong></p>
<p>SharedServices4</p>
</td>
<td valign="top" width="250">
<p>MSSP/MOSSQUERY:56737/SharedServices4 </p>
<p>MSSP/MOSSQUERY:56738/SharedServices4</p>
</td>
</tr>
<tr>
<td valign="top" width="250">
<p><strong>Computer Name: <br></strong></p>
<p>MOSSCRAWL </p>
<p><strong>Name Shared Service Provider <br></strong></p>
<p>SharedServices1</p>
</td>
<td valign="top" width="250">
<p>MSSP/ MOSSCRAWL:56737/ SharedServices1 </p>
<p>MSSP/ MOSSCRAWL:56738/SharedServices1</p>
</td>
</tr>
</tbody>
</table>
<p> </p>
<p><strong>Configure the SSP infrastructure to use Kerberos <br></strong></p>
<p>After you created the Service Principal Names for the SSP Infrastructure you have to inform the SSP infrastructure to use Kerberos. You can inform the SSP infrastructure by using the stsadm tool. </p>
<p>To configure your SSP infrastructure to use Kerberos authentication, perform the following procedure:</p>
<ol>
<li>Log on to your Active Directory domain controller using the credentials of a user that has domain administrative permissions.  </li>
<li>On one of your servers running Office SharePoint Server 2007, open a command prompt.  </li>
<li>Change to the following directory: %COMMONPROGRAMFILES%\microsoft shared\web server extensions\12\bin.  </li>
<li>Type the following command: <strong>stsadm –o setsharedwebserviceauthn –negotiate</strong>, and then press ENTER.</li>
</ol>
<p>After following all the steps you successfully configured your SharePoint farm to use Kerberos authentication.</p>
</div>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#kdc" class="page__taxonomy-item" rel="tag">KDC</a><span class="sep">, </span>
    
      <a href="/tags/#kerberos" class="page__taxonomy-item" rel="tag">Kerberos</a><span class="sep">, </span>
    
      <a href="/tags/#sharepoint" class="page__taxonomy-item" rel="tag">SharePoint</a><span class="sep">, </span>
    
      <a href="/tags/#spn" class="page__taxonomy-item" rel="tag">SPN</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#administration" class="page__taxonomy-item" rel="tag">Administration</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2009-08-08T06:33:00+02:00">August 8, 2009</time></p>


      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?via=maikvandergaag&amp;text=Configure+Kerberos+authentication%20http%3A%2F%2Flocalhost%3A4000%2F2009%2F08%2Fconfigure-kerberos-authentication%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2009%2F08%2Fconfigure-kerberos-authentication%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Flocalhost%3A4000%2F2009%2F08%2Fconfigure-kerberos-authentication%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2009/06/feature-for-adding-a-icon-to-your-sharepoint-farm/" class="pagination--pager" title="Feature for adding a Icon to your SharePoint farm
">Previous</a>
    
    
      <a href="/2009/08/fully-certified-sharepoint-specialist/" class="pagination--pager" title="Fully certified SharePoint Specialist
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2023/05/creating-a-logic-app-api-connection-that-uses-the-managed-identity-using-bicep/" rel="permalink">Creating a Logic App API Connection that uses the Managed Identity using Bicep
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Logic Apps in Azure provides a platform for building workflows that integrate with various services and APIs. When creating Logic Apps, you must often connec...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2023/03/unlocking-the-power-of-azure-app-registrations-a-guide-to-exposing-your-app-as-an-api-with-user-assignments-required-turned-on/" rel="permalink">“Exposing Azure App Registrations as Secure APIs: A Guide to Authentication with ‘User Assignments Required’ Turned On”
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Azure App Registrations are a powerful tool for managing resource access and integrating applications with Microsoft's cloud services. While these registrati...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022/12/centrally-manage-your-app-configurations/" rel="permalink">Centrally manage your App Configurations
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">The application landscape in Azure has grown significantly in recent years, with a wide range of tools and services available to help businesses build, deplo...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/2022/10/shift-left-security-with-microsoft-security-devops-msdo/" rel="permalink">Shift Left Security with Microsoft Security DevOps (MSDO)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">With the new capabilities released add Ignite, you are now even more capable of shifting security checks further to the left. In this article, I explain how ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term...">
  </form>
  <div id="results" class="results"></div>
</div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <script src="/assets/scripts/sidebarcontent.js"></script>
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/maikvandergaag" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.linkedin.com/in/maikvandergaag/" rel="nofollow noopener noreferrer noopener noreferrer" target="_blank"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> Linkedin</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">© 2023 Maik van der Gaag. Powered by <a href="https://jekyllrb.com" rel="nofollow noopener noreferrer" target="_blank">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow noopener noreferrer" target="_blank">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
