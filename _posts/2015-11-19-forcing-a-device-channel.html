---
layout: post
title: Forcing a Device Channel
date: 2015-11-19 08:30:43.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Development
- SharePoint
tags:
- C#
- Device Channel
- SharePoint 2013
meta:
  snap_isAutoPosted: '1'
  _wpt_short_url: http://bit.ly/1MWrTxW
  _wp_jd_target: http://msftplayground.com/2015/11/forcing-a-device-channel/
  _jd_wp_twitter: 'a:2:{i:0;s:56:"New post: Forcing a Device Channel http://bit.ly/1MWrTxW";i:1;s:59:"Post
    Edited: Forcing a Device Channel http://bit.ly/1MWrTxW";}'
  _wpt_status_message: Tweet sent successfully.
  _edit_last: '1'
  _yoast_wpseo_focuskw_text_input: Device Channel
  _yoast_wpseo_focuskw: Device Channel
  _yoast_wpseo_linkdex: '81'
  _snap_forceSURL: '2'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:395:"a:1:{i:0;a:12:{s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:33:"1428116197465709_1641917569418903";s:5:"pDate";s:19:"2015-11-19
    08:30:50";s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"2";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapLI: s:289:"a:1:{i:0;a:9:{s:11:"isPrePosted";s:1:"1";s:4:"doLI";s:1:"1";s:8:"postType";s:1:"A";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:18:"New Post - %TITLE%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  _jd_twitter: ''
  _jd_tweet_this: 'yes'
  pplrpsts_post_views_count: '1'
  _oembed_1ba82f062134c494a889e607d118caea: "{{unknown}}"
  _wds_opengraph: a:3:{s:5:"title";s:0:"";s:11:"description";s:0:"";s:6:"images";a:1:{i:0;s:0:"";}}
  _wds_twitter: a:3:{s:5:"title";s:0:"";s:11:"description";s:0:"";s:6:"images";a:1:{i:0;s:0:"";}}
  _wds_focus-keywords: Device Channel
  _wds_title: ''
  _wds_metadesc: ''
  _wds_meta-robots-adv: ''
  _wds_meta-robots-nofollow: ''
  _wds_canonical: ''
author:
  login: maik@familie-vandergaag.nl
  email: maik@familie-vandergaag.nl
  display_name: Maik van der Gaag
  first_name: Maik
  last_name: van der Gaag
permalink: "/2015/11/forcing-a-device-channel/"
---
<p>Device channels are a way of using different master pages for different devices. MSDN describes the functionality as followed:</p>
<p>&nbsp;</p>
<p>“Browsing the web on a mobile device is now so common that a SharePoint site must be optimized for readability and ease of use on smartphones and other mobile devices such as tablets. With device channels in SharePoint 2013, you can render a single publishing site in multiple ways by using different designs that target different devices. This article can help you plan for using the device channels feature in SharePoint 2013. It provides a detailed overview of the feature itself, and provides the necessary information for creating a device channel. Also, after reading this article, you'll know what device channels you need to implement, and how to implement those channels.”</p>
<p>&nbsp;</p>
<p>Using the out of the box settings you can set the master page by information that is in the user agent string. The information in this string will give SharePoint the information to select the right master page. How the out of the box functionality works can be found here:</p>
<p>&nbsp;</p>
<p><a title="https://msdn.microsoft.com/en-us/library/office/jj862343.aspx" href="https://msdn.microsoft.com/en-us/library/office/jj862343.aspx">https://msdn.microsoft.com/en-us/library/office/jj862343.aspx</a></p>
<p>&nbsp;</p>
<p>This functionality can also be used for other scenarios for example in a CMS setup. When you want to apply this to other scenarios you will have to force a device channel. Forcing device channels can be done using two options:</p>
<p>&nbsp;</p>
<ul>
<li>Query String: Append the “DeviceChannel” query string to your URL and set the value to the “Alias” of your device channel.</li>
<li>Cookie: You can set a cookie named “DeviceChannel”  and set the value of the cookie to the name of your “Alias”.</li>
</ul>
<p>&nbsp;</p>
<p>You can set this cookie in code in order to persist the use of the master page.</p>
<p>&nbsp;</p>
<pre class="brush: csharp;">if (HttpContext.Current.Request.Cookies["DeviceChannel"] == null) {

    string url = HttpContext.Current.Request.Url.ToString();
    using (SPSite site = new SPSite(url)) {
        string authUrl = site.GetProperty(PropertyBagKeys.AuthoringSiteKey, string.Empty);
        string devChannel = site.GetProperty(PropertyBagKeys.AuthDeviceChannel, string.Empty);

        if (!string.IsNullOrEmpty(authUrl)) {
            if (url.StartsWith(authUrl)) {
                HttpCookie cookie = new HttpCookie("DeviceChannel");
                cookie.Value = string.IsNullOrEmpty(devChannel) ? "Default" : devChannel;
                HttpContext.Current.Request.Cookies.Add(cookie);
            } else {
                HttpContext.Current.Request.Cookies.Remove("DeviceChannel");
            }
        }
    }               
}
</pre>
