---
layout: post
title: Custom list view by using the &ldquo;JS Link&rdquo; property.
date: 2014-08-15 14:36:55.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Javascript
tags:
- Javascript
- List View
- SharePoint 2013
meta:
  snap_isAutoPosted: '1'
  _wp_jd_bitly: http://bit.ly/1tebWw3
  _wp_jd_target: http://msftplayground.com/2014/08/custom-list-view-by-using-the-js-link-property/
  _jd_wp_twitter: 'a:1:{i:0;s:88:"Post Edited: Custom list view by using the “JS Link”
    property. http://bit.ly/1tebWw3";}'
  _wpt_status_message: Tweet sent successfully.
  _edit_last: '1'
  _yoast_wpseo_focuskw: js
  _yoast_wpseo_title: Custom list view by using the JS Link property.
  _yoast_wpseo_metadesc: Use the JS Link property for creating a custom list view.
  _jd_twitter: ''
  _jd_tweet_this: 'no'
  _yoast_wpseo_linkdex: '79'
  _thumbnail_id: '918'
  _wpt_short_url: http://msftplayground.com/2014/08/custom-list-view-by-using-the-js-link-property/
  _yoast_wpseo_focuskw_text_input: js
  yuzo_related_post_metabox: a:3:{s:17:"yuzo_include_post";s:0:"";s:17:"yuzo_exclude_post";s:0:"";s:21:"yuzo_disabled_related";N;}
  _jetpack_related_posts_cache: a:0:{}
  _oembed_b79de4fdf5da240e10394853c7ca5234: "{{unknown}}"
  _jetpack_dont_email_post_to_subs: '1'
  _yoast_wpseo_content_score: '30'
  _snap_forceSURL: '2'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:404:"a:1:{i:0;a:13:{s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:33:"1428116197465709_1448627745414554";s:5:"pDate";s:19:"2014-08-18
    07:55:54";s:4:"doFB";i:0;s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"2";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:2:"do";i:0;}}";
  snapLI: s:371:"a:1:{i:0;a:12:{s:11:"isPrePosted";s:1:"1";s:4:"doLI";i:0;s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:18:"New Post - %TITLE%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:8:"postType";s:1:"A";s:2:"do";i:0;s:12:"liMsgFormatT";s:18:"New
    Post - %TITLE%";}}";
  snapTW: s:172:"a:1:{i:0;a:6:{s:2:"do";s:1:"1";s:10:"SNAPformat";s:25:"%TITLE% -
    %URL% - %HTAGS%";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:4:"doTW";s:1:"1";}}";
  _yoast_wpseo_primary_category: ''
  _oembed_b7280214b74283d7a73b39f5e5331d80: "{{unknown}}"
  _wds_opengraph: a:3:{s:5:"title";s:0:"";s:11:"description";s:0:"";s:6:"images";a:1:{i:0;s:0:"";}}
  _wds_twitter: a:3:{s:5:"title";s:0:"";s:11:"description";s:0:"";s:6:"images";a:1:{i:0;s:0:"";}}
  _wds_focus-keywords: js
  _wds_title: Custom list view by using the JS Link property.
  _wds_metadesc: Use the JS Link property for creating a custom list view.
  _wds_meta-robots-adv: ''
  _wds_meta-robots-nofollow: ''
  _wds_canonical: ''
author:
  login: maik@familie-vandergaag.nl
  email: maik@familie-vandergaag.nl
  display_name: Maik van der Gaag
  first_name: Maik
  last_name: van der Gaag
permalink: "/2014/08/custom-list-view-by-using-the-js-link-property/"
---
<p>Customizing a list view could be done by using XSLT in previous version of SharePoint. In SharePoint 2013 this van be done by using the “JS Link” functionality. The “JS Link” functionality is included in list view web parts of SharePoint.</p>
<p>You can use this property for adding specific JavaScript files. You can add 1 or multiple when you want to add multiple you will have to separate them using the “|”  symbol. On the internet you can find a lot of articles on how to use the “JS Link” functionality. Normally the “JS Links”  functionality is used to adjust the rendering of a specific field type in my scenario I had to change the complete list view.</p>
<p>In this article I will show you how to define a custom list view using the “JS Link” functionality according to a specific scenario: On project sites we want to follow the status of site migrations (for example SharePoint sites). The status of these migrations can be saved within SharePoint lists:</p>
<p><a href="http://msftplayground.com/wp-content/uploads/2014/08/clip_image002.gif"><img style="display: inline; border-width: 0px;" title="clip_image002" src="{{ site.baseurl }}/assets/archive/2014/08/clip_image002_thumb.gif" alt="clip_image002" width="218" height="240" border="0" /></a></p>
<p>In this list you will need to have two fields:</p>
<ul>
<li><b>Title:</b> The title of the site that needs to be migrated.</li>
<li><b>Status:</b> The status of the migration. In this example we will have three statuses: “Not started”, “In progress” en “Done”.</li>
</ul>
<p>Using this list we can manage the status of the migrations. At this moment we only have to add functionality to see the migration status of all sites in one view without the use of a farm solution.</p>
<p><a href="http://msftplayground.com/wp-content/uploads/2014/08/clip_image004.gif"><img style="display: inline; border-width: 0px;" title="clip_image004" src="{{ site.baseurl }}/assets/archive/2014/08/clip_image004_thumb.gif" alt="clip_image004" width="240" height="170" border="0" /></a></p>
<p>In the above image you can see the same list but a altered view with the use of “JS LInk”. This view shows a doughnut view with three different colours. So how can we achieve this without creating a full trust solution.</p>
<p>First off all we searched for a JavaScript library to be able to create a doughnut chart. We choose the following library:</p>
<ul>
<li>Chart.js – <a href="http://www.chartjs.org">http://www.chartjs.org</a></li>
</ul>
<p>Now that we have a library we can start writing a JavaScript file that we need to load within the “JS Link” property. Within the JavaScript file we first off all register a namespace to not get in the way of other JavaScript code besides that we also define a view variables that we can  use within the namespace.</p>
<pre class="brush: js;">var migrationStatus = migrationStatus || {};

migrationStatus.InProgressString = 'In progress';
migrationStatus.DoneString = 'Done';
migrationStatus.NotStartedString = 'Not started'; 
migrationStatus.ListName = 'Migration';
migrationStatus.ItemsDone = 0;
migrationStatus.ItemsInProgress = 0;
migrationStatus.ItemsNotStarted = 0;
</pre>
<p>To be able to define template you will need to define specific overrides. These overrides can be defined by using the “RegisterTemplateOverrides” method on the “SPClientTemplates.TemplateManager” object. This method needs one object that defines what needs to be overridden. We will define this within the method: “CustomizeViewRendering”.</p>
<pre class="brush: js;">// Create a function for customizing the view rendering of the list
migrationStatus.CustomizeViewRendering = function () {
    var migrationStatusContext = {};
    migrationStatusContext.Templates = {};
    migrationStatusContext.Templates.View = migrationStatus.RenderMigrationViewBodyTemplate;
    migrationStatusContext.OnPostRender = migrationStatus.OnMigrationViewPostRender;
    SPClientTemplates.TemplateManager.RegisterTemplateOverrides(migrationStatusContext);
};

</pre>
<p>In the “migrationStatusContext” object needs to be defined which rendering methods needs to be overridden. As you can see in the above snippet the “OnPostRender” and the “Templates.View” will be overridden. These methods we will discuss in the upcoming paragraphs.</p>
<p><em>Note:When you override the rendering methods, this will be for every list view on a page. If you want to override the view rendering of one specific list you will have to build in a check if you are performing the action on the correct list. </em></p>
<pre class="brush: js;">migrationStatus.RenderMigrationViewBodyTemplate = function (ctx) {
    if (ctx.Templates.Body == '') {
        return RenderViewTemplate(ctx);
    }

    if (ctx.ListTitle == migrationStatus.ListName) {
        var listData = ctx.ListData;

        for (var idx in listData.Row) {
            var listItem = listData.Row[idx];

            if (listItem.Status == migrationStatus.InProgressString) {
                migrationStatus.ItemsInProgress++;
            } else if (listItem.Status == migrationStatus.NotStartedString) {
                migrationStatus.ItemsNotStarted++;
            } else if (listItem.Status == migrationStatus.DoneString) {
                migrationStatus.ItemsDone++;
            }
        }

        var htmlOutput = [];
        htmlOutput.push('&lt;div id="listData"&gt;&lt;a href="' + ctx.listUrlDir + '"&gt; View this list&lt;/a&gt;&lt;/div&gt;');
        htmlOutput.push('&lt;div id="migrationstatusView" style="height:400px;width:400px;margin-top:10px;float:left;margin-bottom:10px;display:block;"&gt;');
        htmlOutput.push('&lt;canvas id="myChart" width="250" height="250"&gt;&lt;/canvas&gt;');
        htmlOutput.push('&lt;div id="chartLegend" style="width:150px;float:right;" /&gt;');
        htmlOutput.push('&lt;/div&gt;');
        

        var retVal = htmlOutput.join('');
        return retVal;
    }
    else {
        return RenderViewTemplate(ctx);
    }
}
</pre>
<p>The “migrationStatus.RenderMigrationViewBodyTemplate” function needs to be used to adjust the view. This method also receives the context (ctx) object in which all information regarding the context (in this example list) is saved. From this context we can retrieve all of the list data.</p>
<p>But first we will have to check if the body of the template isn’t empty. When it is empty we will have to call the default renderer. After that we can check if the list we are performing the actions for is our migration list: “ctx.ListTitle == migrationStatus.ListName” if this isn’t the case we also call the default rendering function:</p>
<pre class="brush: js;">return RenderViewTemplate(ctx);
</pre>
<p>When this list is our list we count all of the statuses and place them in the specific variables. When all this is done we write out the HTML we need for the rendering of the graph and legend and we return this.</p>
<p>De “PostRender” function will be called as last. In this function the graph will be loaded with the correct data and besides that we will also load the legend of the graph.</p>
<pre class="brush: js;">migrationStatus.OnMigrationViewPostRender = function (ctx) {
    if (ctx.ListTitle == migrationStatus.ListName) {

        var pieData = [
        {
            value: migrationStatus.ItemsNotStarted,
            color: "#F7464A",
            highlight: "#FF5A5E",
            label: migrationStatus.NotStartedString
        },
        {
            value: migrationStatus.ItemsDone,
            color: "#46BFBD",
            highlight: "#5AD3D1",
            label: migrationStatus.DoneString
        },
        {
            value: migrationStatus.ItemsInProgress,
            color: "#FDB45C",
            highlight: "#FFC870",
            label: migrationStatus.InProgressString
        }];
        
        var options = {
            //Boolean - Whether we animate the rotation of the Doughnut
            animateRotate: true,
            //String - A legend template
            legendTemplate: '&lt;ul style="list-style-type:none;" class="&lt;%=name.toLowerCase()%&gt;-legend"&gt;&lt;% for (var i=0; i&lt;segments.length; i++){%&gt;&lt;li&gt;&lt;span style="width:20px;height:10px;display:block;background-color:&lt;%=segments[i].fillColor%&gt;"&gt;&lt;/span&gt;&lt;%if(segments[i].label){%&gt;&lt;%=segments[i].label%&gt;&lt;%}%&gt;&lt;/li&gt;&lt;%}%&gt;&lt;/ul&gt;'
        };

        //get the chart element and setup the doughnut chart
        var ctxChart = document.getElementById("myChart").getContext("2d");
        var myPie = new Chart(ctxChart).Doughnut(pieData, options);

        //generate the legend html
        var legend = document.getElementById("chartLegend");
        legend.innerHTML = myPie.generateLegend();
    }
};
</pre>
<p>In the “PostRender” function we also need to check if we are performing the action for the correct list.</p>
<p>The final thing we need to adjust to the JavaScript file is adding the following line:</p>
<pre class="brush: js;">migrationStatus.CustomizeViewRendering();
</pre>
<p>This line of code will be called on the moment the file is loaded and by calling this function is will make sure that the overrides for the list views will be registered.</p>
<p>Know that the files are ready we only need to specify the files in the “JS Link” property of the list view.</p>
<p><a href="http://msftplayground.com/wp-content/uploads/2014/08/clip_image006.jpg"><img style="display: inline; border-width: 0px;" title="clip_image006" src="{{ site.baseurl }}/assets/archive/2014/08/clip_image006_thumb.jpg" alt="clip_image006" width="115" height="244" border="0" /></a></p>
<p>In the “JS Link” we have specified the following value:</p>
<pre class="brush: bash;">/siteassets/Migration/Chart.js|/siteassets/Migration/MigrationStatus.js
</pre>
<ul>
<li><strong>/siteassets/Migration/Chart.js</strong>: JavaScript library for the generation of graphs.</li>
<li><strong>/siteassets/Migration/MigrationStatus.js</strong>: JavaScript file for the list view.</li>
</ul>
<p>&nbsp;</p>
<p><strong>GitHub Repository:</strong></p>
<p><a href="https://github.com/MaikvanderGaag/MigrationStatus">https://github.com/MaikvanderGaag/MigrationStatus</a></p>
<p>Video from <a href="https://www.webucator.com/microsoft-training/sharepoint.cfm" target="_blank">Webucator </a>with a complete outline of my blog post:</p>
<p><iframe src="https://www.youtube.com/embed/ErLiVRjlVzs" width="560" height="315" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<p>&nbsp;</p>
