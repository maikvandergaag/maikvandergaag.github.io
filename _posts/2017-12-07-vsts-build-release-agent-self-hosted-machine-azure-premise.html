---
layout: post
title: VSTS build or release agent on a self hosted machine in Azure or on premise
date: 2017-12-07 10:37:34.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- DevOps
tags:
- ALM
- Azure
- DevOps
- VSTS
meta:
  yuzo_related_post_metabox: a:1:{s:21:"yuzo_disabled_related";N;}
  _edit_last: '1'
  _yoast_wpseo_content_score: '90'
  _yoast_wpseo_primary_category: ''
  _yoast_wpseo_focuskw_text_input: VSTS
  _yoast_wpseo_focuskw: VSTS
  _yoast_wpseo_linkdex: '76'
  snap_MYSURL: a:3:{s:1:"s";s:21:"http://bit.ly/2AW6Gd9";s:1:"t";s:93:"http://msftplayground.com/2017/12/vsts-build-release-agent-self-hosted-machine-azure-premise/";s:1:"r";s:1:"B";}
  snap_isAutoPosted: '1512639466'
  _snapPHST: a:2:{s:2:"fb";a:1:{i:0;a:1:{i:0;a:4:{s:1:"l";s:61:"http://www.facebook.com/msftplayground/posts/1988295264781130";s:2:"id";s:33:"1428116197465709_1988295264781130";s:1:"d";s:19:"2017-12-07
    09:37:46";s:1:"w";s:1:"s";}}}s:2:"tw";a:1:{i:0;a:1:{i:0;a:4:{s:1:"l";s:60:"https://twitter.com/maikvandergaag/status/938704075507535873";s:2:"id";s:18:"938704075507535873";s:1:"d";s:19:"2017-12-07
    09:37:46";s:1:"w";s:1:"s";}}}}
  _snap_forceSURL: '1'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:436:"a:1:{i:0;a:12:{s:2:"do";s:1:"1";s:9:"msgFormat";s:51:"New post (%TITLE%)
    has been published on %SITENAME%";s:8:"postType";s:1:"A";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:4:"doFB";i:0;s:8:"isPosted";s:1:"1";s:4:"pgID";s:33:"1428116197465709_1988295264781130";s:7:"postURL";s:61:"http://www.facebook.com/msftplayground/posts/1988295264781130";s:5:"pDate";s:19:"2017-12-07
    09:37:46";}}";
  snapLI: s:228:"a:1:{i:0;a:8:{s:2:"do";s:1:"1";s:9:"msgFormat";s:41:"New post has
    been published on %SITENAME%";s:8:"postType";s:1:"A";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:4:"doLI";i:0;}}";
  snapTW: s:394:"a:1:{i:0;a:12:{s:2:"do";s:1:"1";s:9:"msgFormat";s:25:"%TITLE% - %URL%
    - %HTAGS%";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:4:"doTW";i:0;s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"938704075507535873";s:7:"postURL";s:60:"https://twitter.com/maikvandergaag/status/938704075507535873";s:5:"pDate";s:19:"2017-12-07
    09:37:46";}}";
  _wpas_done_all: '1'
  _oembed_1ba82f062134c494a889e607d118caea: "{{unknown}}"
  medium_post: O:11:"Medium_Post":11:{s:16:"author_image_url";N;s:10:"author_url";N;s:11:"byline_name";N;s:12:"byline_email";N;s:10:"cross_link";N;s:2:"id";N;s:21:"follower_notification";N;s:7:"license";N;s:14:"publication_id";N;s:6:"status";N;s:3:"url";N;}
  _wds_opengraph: a:3:{s:5:"title";s:0:"";s:11:"description";s:0:"";s:6:"images";a:1:{i:0;s:0:"";}}
  _wds_twitter: a:3:{s:5:"title";s:0:"";s:11:"description";s:0:"";s:6:"images";a:1:{i:0;s:0:"";}}
  _wds_focus-keywords: VSTS
  _wds_title: ''
  _wds_metadesc: ''
  _wds_meta-robots-adv: ''
  _wds_meta-robots-nofollow: ''
  _wds_canonical: ''
author:
  login: maik@familie-vandergaag.nl
  email: maik@familie-vandergaag.nl
  display_name: Maik van der Gaag
  first_name: Maik
  last_name: van der Gaag
permalink: "/2017/12/vsts-build-release-agent-self-hosted-machine-azure-premise/"
---
<p>You can think of many situations where you would like to create a self hosted machine for Visual Studio team services (VSTS). Installing and configuring a self hosted machine requires only a few steps.</p>
<p>Before you begin make sure the system meets the pre-requisites:</p>
<ul>
<li><span style="font-weight: bold;">Windows 10 and Beyond (64-bit): <span style="font-weight: normal;">No known system prerequisites at this time.</span></span></li>
<li><strong>Windows 7 to Windows 8.1, Windows Server 2008 R2 SP1 to Windows Server  : </strong><a href="https://msdn.microsoft.com/en-us/powershell/scripting/setup/installing-windows-powershell">PowerShell 3.0 or higher</a></li>
<li><strong>Visual Studio: </strong>Not technically required by the agent, but many build scenarios need Visual Studio.</li>
</ul>
<p>Besides the system pre-requisites there is also an account pre-requisite:</p>
<ul>
<li>Account with Personal Access Token.</li>
</ul>
<h2>Create a Personal access token</h2>
<p>Creating a Personal Access Token (PAT) requires the following steps:</p>
<ol>
<li>Navigate to the VSTS tenant were you want to add an agent.</li>
<li>In the top bar click on your icon and click on “Security”.</li>
</ol>
<p><a href="https://msftplayground.com/wp-content/uploads/2017/12/image.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Account Options" src="{{ site.baseurl }}/assets/archive/2017/12/image_thumb.png" alt="Account options" width="231" height="240" border="0" /></a></p>
<ol start="3">
<li>Within the security window click on Personal Access Token.</li>
</ol>
<p><a href="https://msftplayground.com/wp-content/uploads/2017/12/image-1.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Personal Access Token" src="{{ site.baseurl }}/assets/archive/2017/12/image_thumb-1.png" alt="Personal Access Token" width="542" height="133" border="0" /></a></p>
<ol start="4">
<li>Click on “Add”  to generate a new personal access token and make sure you select the following scopes:
<ul>
<li>Agent Pools (read, manage)</li>
<li>Deployment group (read, manage)</li>
</ul>
</li>
</ol>
<p><a href="https://msftplayground.com/wp-content/uploads/2017/12/clip_image001.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Personal Access Token Creation" src="{{ site.baseurl }}/assets/archive/2017/12/clip_image001_thumb.png" alt="Personal Access Token Creation" width="390" height="379" border="0" /></a></p>
<ol start="5">
<li>Save the generated token.</li>
</ol>
<p>&nbsp;</p>
<h2>Install VSTS agent</h2>
<p>With all the pre-requisites in place we can start with the agent itself.</p>
<ol>
<li>Logon to the server that will be the self hosted machine.</li>
<li>Navigate to the VSTS tenant were you want to add an agent.</li>
<li>Go to Setting –&gt; Agent Pools  and click on “Create new Pool”</li>
</ol>
<p><em>The pool is a logical container for the agents that you add to VSTS. You can name the pool after the company of define another logical name.</em></p>
<p>&nbsp;</p>
<p><a href="https://msftplayground.com/wp-content/uploads/2017/12/image-2.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="New Pool" src="{{ site.baseurl }}/assets/archive/2017/12/image_thumb-2.png" alt="New Pool" width="240" height="113" border="0" /></a></p>
<p>&nbsp;</p>
<ol start="4">
<li>Create a folder on the server to install the agent.</li>
</ol>
<p><em>It is a good practice to keep the folder naming as short as possible (D:\a or D:\agent). </em></p>
<ol start="4">
<li>Download the agent and extract it to the folder you created.</li>
</ol>
<p><a href="https://msftplayground.com/wp-content/uploads/2017/12/image-3.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Agent Folder" src="{{ site.baseurl }}/assets/archive/2017/12/image_thumb-3.png" alt="Agent Folder" width="348" height="175" border="0" /></a></p>
<ol start="4">
<li>Open a PowerShell window as administrator and navigate to the created folder.</li>
<li>Run the below command:</li>
</ol>
<pre class="brush: powershell;">.\config.cmd
</pre>
<ol start="6">
<li>During the execution you need to fill in specific information about your tenant.</li>
</ol>
<p><a href="https://msftplayground.com/wp-content/uploads/2017/12/image-4.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="Agent Configuration" src="{{ site.baseurl }}/assets/archive/2017/12/image_thumb-4.png" alt="Agent Configuration" width="351" height="193" border="0" /></a></p>
<p>&nbsp;</p>
<p>At the end of the script the agent is started. The installed agent should now be visible within the agent pool in VSTS.</p>
<p><a href="https://msftplayground.com/wp-content/uploads/2017/12/image-5.png"><img style="background-image: none; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-width: 0px;" title="image" src="{{ site.baseurl }}/assets/archive/2017/12/image_thumb-5.png" alt="image" width="577" height="202" border="0" /></a></p>
